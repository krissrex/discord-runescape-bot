/*! (c) 2019 Jagex Limited */

var app;-1!==window.location.href.indexOf("#")&&(window.location=window.location.href.split("#")[0]),app=angular.module("app",["angulartics","angulartics.google.analytics","ui.router","ngTable","overview","settings","graphs","loader","loading","ngAnimate","ngLodash","ngStorage","shared","player-bar","skills","timeline","user","xp-gains","pvm-kills","drop-log","wealth-change","breadcrumb","activities","levels","user-menu","main-menu","summary","subscribe","upsell","search","welcome","friends","friends-activity","quests"]),app.constant("CONFIG",{AJAX_TIMOUT:5e3,CONTEXT:_ctx.url,START_DATE:_ctx.startDate}),app.config(function($urlRouterProvider,$locationProvider,$httpProvider){return $urlRouterProvider.otherwise("/"),$locationProvider.html5Mode(!0),$httpProvider.interceptors.push("user.account-interceptor","shared.context-interceptor")}),app.run(["$rootScope","user.account","$state","timeline.manager","user.player",function($rootScope,userAccount,$state,timelineManager,userPlayer){return $rootScope.$on("$stateChangeStart",function(ev,toState,toParams){var reqAuth;return reqAuth=!0,toState.data&&void 0!==toState.data.reqAuth&&(reqAuth=toState.data.reqAuth),!0===reqAuth&&userAccount.getDetails().then(function(accountDetails){return $rootScope.user=accountDetails}).then(function(data){var userType;if(!0===toState.data.subscribe&&!1===data.subscribed)switch(toState.name){case"pvm-kills":$state.go("subscribe-kills-drops");break;case"xp-gains":case"xp-gains-graph":$state.go("subscribe-xp-gains");break;default:$state.go("subscribe")}if(!0===data.subscribed&&(userType="PRO"),!1===data.subscribed&&(userType="FREE"),ga("set","dimension1",userType),"overview"===toState.name)return ga("send","pageview","/my-profile")}),userPlayer.getDetails().then(function(playerDetails){return $rootScope.player=playerDetails})}),$rootScope.$on("$viewContentLoaded",function(ev,toState,toParams){if(window.scrollTo(0,0),$rootScope.selectTime=!0,$rootScope.selectSettings=!0,$state.current.data&&(void 0!==$state.current.data.timeline&&($rootScope.selectTime=$state.current.data.timeline),void 0!==$state.current.data.settings))return $rootScope.selectSettings=$state.current.data.settings}),$(document).foundation()}]),angular.module("shared",[]),angular.module("shared").factory("shared.calculators",function(){var numberSimplifier;return numberSimplifier=function(num){return function(){switch(!1){case!(num>=1e6):return Math.floor(num/1e6)+"m";case!(num>=1e3):return Math.floor(num/1e3)+"k";default:return num}}()},{numberSimplifier:numberSimplifier}}),angular.module("shared").factory("shared.screen-size",function(){function getMedia(){var isXLargeOnly=!1,isLargeOnly=!1,isMediumOnly=!1,isSmallOnly=!1,isXXLargeUp=!1,isXLargeUp=!1,isLargeUp=!1,isMediumUp=!1,isSmallUp=!1;return Modernizr.mq(Foundation.media_queries.small)&&(isSmallUp=!0),Modernizr.mq(Foundation.media_queries.medium)&&(isSmallUp=!0,isMediumUp=!0),Modernizr.mq(Foundation.media_queries.large)&&(isSmallUp=!0,isMediumUp=!0,isLargeUp=!0),Modernizr.mq(Foundation.media_queries.xlarge)&&(isSmallUp=!0,isMediumUp=!0,isLargeUp=!0,isXLargeUp=!0),Modernizr.mq(Foundation.media_queries.xxlarge)&&(isSmallUp=!0,isMediumUp=!0,isLargeUp=!0,isXLargeUp=!0,isXXLargeUp=!0),Modernizr.mq(Foundation.media_queries["xlarge-only"])?isXLargeOnly=!0:Modernizr.mq(Foundation.media_queries["large-only"])?isLargeOnly=!0:Modernizr.mq(Foundation.media_queries["medium-only"])?isMediumOnly=!0:Modernizr.mq(Foundation.media_queries["small-only"])&&(isSmallOnly=!0),{isXLargeOnly:isXLargeOnly,isLargeOnly:isLargeOnly,isMediumOnly:isMediumOnly,isSmallOnly:isSmallOnly,isXXLargeUp:isXXLargeUp,isXLargeUp:isXLargeUp,isLargeUp:isLargeUp,isMediumUp:isMediumUp,isSmallUp:isSmallUp}}function getWidth(){return dimensions.width}function getHeight(){return dimensions.height}function getDimensions(){return dimensions}function setDimensions(newDimensions){dimensions=newDimensions}var dimensions={width:0,height:0,document:{width:0,height:0},content:{width:0,height:0}};return{getMedia:getMedia,setDimensions:setDimensions,getWidth:getWidth,getHeight:getHeight,getDimensions:getDimensions}}),angular.module("shared").factory("shared.context-interceptor",["$templateCache","CONFIG",function($templateCache,CONFIG){var request;return request=function(config){var url;return url=config.url,void 0===$templateCache.get(url)&&0!==url.indexOf("https://")&&(0!==url.indexOf("/")&&(url="/"+url),config.url=CONFIG.CONTEXT+url),config},{request:request}}]),angular.module("shared").factory("overlay.manager",[function(){var getOverlayState,overlayShown,setOverlayState;return overlayShown=!1,getOverlayState=function(){return overlayShown},setOverlayState=function(setting){return overlayShown=setting},{getOverlayState:getOverlayState,setOverlayState:setOverlayState}}]),angular.module("shared").directive("title",function($rootScope,lodash){function link(scope,element,attrs){$rootScope.$on("$stateChangeSuccess",function(event,toState){var title=suffix;lodash.isUndefined(toState.data)||lodash.isUndefined(toState.data.title)||(title=toState.data.title+" - "+suffix),$rootScope.title=title})}var suffix="RuneMetrics - RuneScape player stat tracking";return{link:link,restrict:"E"}}),angular.module("shared").directive("content",["shared.screen-size","$timeout",function(screenSize,$timeout){var link;return link=function(scope,element,attrs){var adjustContentSize;return adjustContentSize=function(height){return element.find(".content__wrapper").css("min-height",height)},scope.$on("$stateChangeSuccess",function(){return element.ready(function(){return adjustContentSize(screenSize.getHeight())})}),scope.$watch(function(){return screenSize.getHeight()},function(height){return element.ready(function(){return adjustContentSize(height)})})},{link:link,restrict:"C"}}]),angular.module("shared").directive("html",["$window","$document","shared.screen-size",function($window,$document,screenSize){function resize(){var $content=angular.element(".content");screenSize.setDimensions({width:$win.width(),document:{width:$doc.width(),height:$doc.height()},content:{width:$content.width(),height:$content.height()}})}function link(scope){$win.bind("resize",function(){resize(),scope.$apply()}),resize()}var $win=angular.element($window),$doc=angular.element($document);return{link:link,restrict:"E"}}]),angular.module("shared").directive("header",["$state","timeline.manager","shared.screen-size","settings.manager","overlay.manager","main-menu.manager","user-menu.manager",function($state,timelineManager,screenSize,settingsManager,overlayManager,mainMenuManager,userMenuManager){var link;return link=function(scope,element,attrs){var adjustNav,checkNavView,closeOthers,navigation;return navigation=element.find(".main-navigation"),scope.mainMenuActive=mainMenuManager.getMenuState(),scope.timelinePickerActive=timelineManager.getPickerState(),scope.settingsMenuActive=settingsManager.getMenuState(),scope.userMenuActive=userMenuManager.getMenuState(),scope.$state=$state,closeOthers=function(dontClose){if(scope.mainMenuActive&&"main"!==dontClose&&!screenSize.getMedia().isLargeUp&&(scope.mainMenuActive=mainMenuManager.toggleMainMenu()),scope.settingsMenuActive&&"settings"!==dontClose&&(scope.settingsMenuActive=settingsManager.toggleMenu()),scope.timelinePickerActive&&"picker"!==dontClose&&(scope.timelinePickerActive=timelineManager.togglePicker()),scope.userMenuActive&&"user"!==dontClose)return scope.userMenuActive=userMenuManager.toggleUserMenu()},checkNavView=function(){if(closeOthers(),screenSize.getMedia().isLargeUp)return scope.mainMenuActive=mainMenuManager.openMainMenu(),overlayManager.setOverlayState(!1)},adjustNav=function(newHeight){var height;return screenSize.getMedia().isLargeUp?(height=newHeight-navigation.offsetTop,navigation.height(height)):navigation.height("auto")},scope.toggleMainMenu=function(){return closeOthers("main"),overlayManager.setOverlayState("main"),scope.mainMenuActive=mainMenuManager.toggleMainMenu()},scope.closeMainMenu=function(){if(!screenSize.getMedia().isLargeUp)return scope.mainMenuActive=mainMenuManager.closeMainMenu()},scope.toggleTimelinePicker=function(){return closeOthers("picker"),scope.timelinePickerActive=timelineManager.togglePicker()},scope.toggleSettingsMenu=function(){return closeOthers("settings"),scope.settingsMenuActive=settingsManager.toggleMenu()},scope.toggleUserMenu=function(){return closeOthers("user"),scope.userMenuActive=userMenuManager.toggleUserMenu()},scope.$watch(function(){return screenSize.getHeight()},function(newHeight){return adjustNav(newHeight)}),scope.$watch(function(){return screenSize.getWidth()},function(){return checkNavView(),adjustNav(screenSize.getHeight())}),scope.$watch(function(){return timelineManager.getPickerState()},function(state){return closeOthers("picker"),scope.timelinePickerActive=state}),scope.$watch(function(){return settingsManager.getMenuState()},function(state){return scope.settingsMenuActive=state}),scope.$watch(function(){return mainMenuManager.getMenuState()},function(state){return scope.mainMenuActive=state,screenSize.getMedia().isLargeUp||!0!==state?angular.element("body").removeClass("fixed-body"):angular.element("body").addClass("fixed-body")}),scope.$watch(function(){return userMenuManager.getMenuState()},function(state){return scope.userMenuActive=state})},{link:link,restrict:"E",scope:{},templateUrl:"/template/shared/shared.header.ftl"}}]),angular.module("shared").directive("footer",[function(){return{restrict:"E",scope:{},templateUrl:"/template/shared/shared.footer.ftl"}}]),angular.module("shared").directive("overlay",["timeline.manager","user-menu.manager","overlay.manager","main-menu.manager","shared.screen-size","settings.manager",function(timelineManager,userMenuManager,overlayManager,mainMenuManager,screenSize,settingsManager){var link;return link=function(scope,element,attr){return scope.display=!1,scope.click=function(){return timelineManager.closePicker(),userMenuManager.closeUserMenu(),settingsManager.closeSettingsMenu(),screenSize.getMedia().isLargeUp||mainMenuManager.closeMainMenu(),scope.display=!1},scope.$watch(function(){return overlayManager.getOverlayState(),overlayManager.getOverlayState()},function(state){return scope.display=state})},{link:link,templateUrl:"/template/shared/shared.overlay.ftl",restrict:"E"}}]),angular.module("loader",[]),angular.module("loader").factory("loader.manager",function(lodash){var loading=[];return{isLoading:function(_id){var id=_id;lodash.isUndefined(id)&&(id=moment().valueOf()),loading.push(id)},isNotLoading:function(id){lodash.isUndefined(id)?loading=[]:lodash.pull(loading,id)},getLoading:function(){return loading}}}),angular.module("loader").directive("loaderGraphic",["loader.manager","timeline.manager",function(loaderManager,timelineManager){var link;return link=function(scope,element,attrs){return scope.loading=loaderManager.getLoading().length>0,element.bind("click",function(){if(timelineManager.getPickerState())return timelineManager.togglePicker(),scope.$apply()}),scope.$watch(function(){return loaderManager.getLoading().length},function(newValue,oldValue){return scope.loading=newValue>0})},{link:link,restrict:"E",scope:{},templateUrl:"/template/loader/loader.graphic.ftl"}}]),angular.module("settings",[]),angular.module("settings").factory("settings.manager",["$localStorage","overlay.manager",function($localStorage,overlayManager){var menuActive=!1,personalBestActive=!1,average=!1;$localStorage.$default({settings:{pbest:personalBestActive,average:average}}),$localStorage.settings.pbest&&(personalBestActive=!0),$localStorage.settings.average&&(average=!0);var toggleMenu=function(){return menuActive=!menuActive};return{toggleMenu:toggleMenu,closeSettingsMenu:function(){menuActive=!0,toggleMenu()},togglePersonalBest:function(){return personalBestActive=!personalBestActive,$localStorage.settings.pbest=personalBestActive,personalBestActive},toggleAverage:function(){return average=!average,$localStorage.settings.average=average,average},getMenuState:function(){return menuActive},getPersonalBestState:function(){return personalBestActive},getAverageState:function(){return average}}}]),angular.module("settings").directive("settingsMenu",["settings.manager","lodash","$rootScope","overlay.manager",function(settingsManager,lodash,$rootScope,overlayManager){function link(scope,element,attrs){scope.isActive=!1,scope.personalBestActive=settingsManager.getPersonalBestState(),scope.averageActive=settingsManager.getAverageState(),scope.isVisible=!1,scope.toggleMenu=function(){settingsManager.toggleMenu()},scope.personalBestToggle=function(){settingsManager.togglePersonalBest()},scope.averageToggle=function(){settingsManager.toggleAverage()},scope.$watch(function(){return settingsManager.getMenuState()},function(state){scope.isActive=state,overlayManager.setOverlayState(state)}),scope.$watch(function(){return settingsManager.getPersonalBestState()},function(state){scope.personalBestActive=state}),scope.$watch(function(){return settingsManager.getAverageState()},function(state){scope.averageActive=state}),$rootScope.$on("$stateChangeSuccess",function(event,toState){lodash.isUndefined(toState.data)||lodash.isUndefined(toState.data.settings)?scope.isVisible=!0:toState.data.settings||(scope.isVisible=!1)})}return{link:link,restrict:"E",scope:{},templateUrl:"/template/settings/settings.menu.ftl"}}]),angular.module("subscribe",[]),angular.module("subscribe").directive("subscribeBanner",["user.account",function(userAccount){var link;return link=function(scope,element,attr){return scope.display=!0,$.cookie("hideSubscribe")?scope.display=!1:!0===userAccount.getUser().subscribed&&(scope.display=!1),scope.setHideCookie=function(){return $.cookie("hideSubscribe","true",{expires:14}),scope.display=!1}},{link:link,restrict:"E",scope:{},templateUrl:"/template/subscribe/subscribe.subscribe-banner.ftl"}}]),angular.module("main-menu",[]),angular.module("main-menu").factory("main-menu.manager",["overlay.manager","user-menu.manager",function(overlayManager,userMenuManager){var closeMainMenu,getMenuState,mainMenuIsShown,openMainMenu,toggleMainMenu;return mainMenuIsShown=!1,toggleMainMenu=function(){return mainMenuIsShown=!mainMenuIsShown,overlayManager.setOverlayState(mainMenuIsShown)},closeMainMenu=function(){return mainMenuIsShown=!1,overlayManager.setOverlayState(mainMenuIsShown)},openMainMenu=function(){return mainMenuIsShown=!0,overlayManager.setOverlayState(mainMenuIsShown)},getMenuState=function(){return mainMenuIsShown},{toggleMainMenu:toggleMainMenu,closeMainMenu:closeMainMenu,openMainMenu:openMainMenu,getMenuState:getMenuState}}]),angular.module("main-menu").directive("mainMenu",["$rootScope","$state","user.player","shared.screen-size","main-menu.manager",function($rootScope,$state,userPlayer,screenSize,mainMenuManager){var link;return link=function(scope,element,attr){var menuSwitch;return scope.$state=$state,scope.dropdown={xp:!1,friends:!1,activity:!1},menuSwitch=function(player){var userType;switch(scope.isHome=!1,$rootScope.player&&$rootScope.player.name&&(scope.loggedIn=!0),$state.current.name){case"welcome":case"welcome-ad-log":scope.isHome=!0,scope.loggedIn=!1,userType="NOT_LOGGED_IN",ga("set","dimension1",userType),ga("send","pageview","/welcome")}return player.name?$state.current.data.searched?(scope.searchedUser=player.urlName,!1===scope.loggedIn?(userType="NOT_LOGGED_IN",ga("set","dimension1",userType)):void 0):(scope.playerName=player.urlName,scope.searchedUser=!1):scope.searchedUser=!1},scope.closeLink=function(){if(!screenSize.getMedia().isLargeUp)return scope.mainMenuActive=mainMenuManager.closeMainMenu()},scope.toggleSwitch=function(item){switch(item){case"xp":return scope.dropdown.xp=!scope.dropdown.xp;case"friends":return scope.dropdown.friends=!scope.dropdown.friends;case"activity":return scope.dropdown.activity=!scope.dropdown.activity}},scope.$watch(function(){return userPlayer.returnSearchedDetails()},function(player){return menuSwitch(player)}),scope.$watch(function(){return userPlayer.returnPlayerDetails()},function(player){return menuSwitch(player)}),$rootScope.$on("$stateChangeStart",function(){return scope.closeLink()}),$rootScope.$on("$stateChangeSuccess",function(){return menuSwitch(userPlayer.returnSearchedDetails())})},{link:link,restrict:"E",scope:{},templateUrl:"/template/main-menu/main-menu.menu.ftl"}}]),angular.module("timeline",[]),angular.module("timeline").factory("timeline.util",["lodash",function(lodash){var addAdjacency;return addAdjacency=function(adjacency,dateRange){var offset;return offset=(dateRange.end.valueOf()-dateRange.start.valueOf())/(100/adjacency),{start:dateRange.start.valueOf()-offset,end:dateRange.end.valueOf()+offset}},{addAdjacency:addAdjacency}}]),angular.module("timeline").factory("timeline.manager",["overlay.manager","CONFIG",function(overlayManager,CONFIG){var end=moment().utc(),start=moment().utc(),fidelity="",pickerActive=!1,EPOC=moment(CONFIG.START_DATE,"DD MM YYYY"),setInitialRange=function(){var end=moment().utc().endOf("day"),start=moment().utc().startOf("day").subtract("6","days");setActiveDate({start:start,end:end})},getActiveDate=function(){return{start:start,end:end}},setActiveDate=function(newRange){var newStart=newRange.start,newEnd=newRange.end;moment.isMoment(newStart)||(newStart=moment(newStart)),moment.isMoment(newEnd)||(newEnd=moment(newEnd)),fidelity=newStart.isSame(newEnd,"hour")?"minute":newStart.isSame(newEnd,"day")?"hour":"day",newStart.isSame(start)||(start=newStart),newEnd.isSame(end)||(end=newEnd)},getHumanDate=function(newDates){var fullString,start=newDates.start,end=newDates.end,getYear=function(date){return date.isSame(moment(),"year")?"":date.year()},endString=end.format("ddd DD MMM")+" "+getYear(end);return start.isSame(end,"year")?fullString=start.isSame(end,"month")?start.isSame(end,"day")?start.isSame(end,"hour")?endString+" at "+start.format("hh:mm a"):endString:start.format("ddd DD")+" - "+endString:start.format("ddd DD MMM")+" - "+endString:(endString=end.format("DD MMM")+" "+end.year(),fullString=start.format("DD MMM")+" "+getYear(start)+" - "+endString),fullString},closePicker=function(){pickerActive=!0,togglePicker()},togglePicker=function(){var state=!pickerActive;return pickerActive=state,overlayManager.setOverlayState(state),state},getPickerState=function(){return pickerActive},getFidelity=function(){return fidelity},roundToDay=function(date){setActiveDate({start:moment(date.start).startOf("day"),end:moment(date.end).endOf("day")})};return setInitialRange(),{EPOC:EPOC,getActiveDate:getActiveDate,setActiveDate:setActiveDate,setInitialRange:setInitialRange,getHumanDate:getHumanDate,closePicker:closePicker,togglePicker:togglePicker,getPickerState:getPickerState,getFidelity:getFidelity,roundToDay:roundToDay}}]),angular.module("timeline").directive("timelineDisplayRange",["timeline.manager",function(timelineManager){var link;return link=function(scope,element,attrs){return scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue){return scope.range=timelineManager.getHumanDate(newValue)})},{link:link,restrict:"E",scope:{},templateUrl:"/template/timeline/timeline.display-range.ftl"}}]),angular.module("timeline").directive("timelineButton",["timeline.manager",function(timelineManager){var link;return link=function(scope,element,attr){return scope.togglePicker=function(){return timelineManager.togglePicker()},scope.$watch(function(){return timelineManager.getPickerState()},function(state){return scope.isActive=state})},{link:link,restrict:"E",scope:{},templateUrl:"/template/timeline/timeline.button.ftl"}}]),angular.module("timeline").directive("timelinePicker",["timeline.manager","lodash","$rootScope",function(timelineManager,lodash,$rootScope){function valid(value){return-1===lodash.indexOf(value,void 0)}function link(scope,element,attrs){scope.start=date.start.format("DD MMM YYYY"),scope.end=date.end.format("DD MMM YYYY"),scope.isActive=!1,scope.isVisible=!1,angular.element(".timeline-picker__input").on("focus",function(){angular.element(this).parents(".timeline-picker__label").addClass("timeline-picker__label--active")}).on("blur",function(){angular.element(this).parents(".timeline-picker__label").removeClass("timeline-picker__label--active")});var epoc=timelineManager.EPOC,today=moment(),startSelector=element.find('[gldp-id="start-date"]').glDatePicker({cssName:"runemetrics",dowNames:"SMTWTFS",selectableDateRange:[{from:epoc.toDate(),to:today.toDate()}],onClick:function(target,cell,selectedDate){var endDate=timelineManager.getActiveDate().end,selectedMoment=moment.utc(selectedDate,"ddd MMM D YYYY").startOf("day");endDate.isBefore(selectedMoment)&&(endDate=selectedMoment);var newDate={start:selectedMoment,end:endDate};timelineManager.setActiveDate(newDate),element.find('[gldp-id="end-date"]').focus(),scope.$apply()}}).glDatePicker(!0),endSelector=element.find('[gldp-id="end-date"]').glDatePicker({cssName:"runemetrics",dowNames:"SMTWTFS",selectableDateRange:[{from:moment(timelineManager.getActiveDate().start).toDate(),to:today.toDate()}],onClick:function(target,cell,selectedDate){var selectedMoment=moment.utc(selectedDate,"ddd MMM D YYYY").endOf("day"),newDate={start:timelineManager.getActiveDate().start,end:selectedMoment};timelineManager.setActiveDate(newDate),element.find('[gldp-id="start-date"], [gldp-id="end-date"]').blur(),timelineManager.closePicker(),scope.$apply()}}).glDatePicker(!0);scope.$watch(function(){return timelineManager.getPickerState()},function(state){scope.isActive=state}),scope.quickRange=function(period){switch(date={start:moment().utc().startOf("day"),end:moment().utc().endOf("day")},period){case"yesterday":date.start.subtract(1,"day"),date.end.subtract(1,"day").endOf("day");break;case"seven-days":date.start.subtract(6,"day");break;case"thirty-days":date.start.subtract(29,"day")}timelineManager.setActiveDate(date),timelineManager.closePicker()},scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue,oldValue){var startDate=moment(newValue.start),endDate=moment(newValue.end);scope.start=newValue.start.format("DD MMM YYYY"),scope.end=newValue.end.format("DD MMM YYYY"),angular.extend(endSelector.options,{selectedDate:endDate.toDate(),selectableDateRange:[{from:startDate.toDate(),to:today.toDate()}]}),endSelector.render(),angular.extend(startSelector.options,{selectedDate:startDate.toDate()}),startSelector.render()}),scope.$watchGroup(["start","end"],function(newValue){if(valid(newValue)){var newActiveDate={start:newValue[0],end:newValue[1]},currentActiveDate=timelineManager.getActiveDate(),cleanCurrentActiveDate={start:currentActiveDate.start.format("DD MMM YYYY"),end:currentActiveDate.end.format("DD MMM YYYY")};lodash.isEqual(cleanCurrentActiveDate,newActiveDate)||timelineManager.setActiveDate(newActiveDate)}})}var date=timelineManager.getActiveDate();return{link:link,restrict:"E",scope:{},templateUrl:"/template/timeline/timeline.picker.ftl"}}]),angular.module("user",[]).config(function($stateProvider){$stateProvider.state("logout",{url:"/logout",templateUrl:"/template/user/user.logout.ftl",controller:"UserLogoutController",data:{title:"Logout",timeline:!1,settings:!1}})}),angular.module("user").factory("user.account",["$http","$log","$q","lodash","$rootScope",function($http,$log,$q,lodash,$rootScope){var user={};return{logout:function(){var deferred=$q.defer();return $http.get("/logout").success(function(data){deferred.resolve(data)}).error(function(data,code){$log.info("Wasn't able to log out, server responded with code: "+code),deferred.reject(code)}),deferred.promise},getDetails:function(){var deferred=$q.defer();return 0===lodash.size(user)?$http.get("/getUser").then(function(response){user=response.data,deferred.resolve(user)},function(response){deferred.reject(response.status)}):deferred.resolve(user),deferred.promise},setSubscription:function(subscribed){user.subscribed=subscribed,$rootScope.user=user},getUser:function(){return user}}}]),angular.module("user").factory("user.account-interceptor",["$q","$injector","$window",function($q,$injector,$window){return{responseError:function(rejection){var deferred=$q.defer();return $injector.invoke(["$location","user.account",function($location,account){403===rejection.status&&(rejection.data.redirectUrl?-1!==$location.url().indexOf("welcome")?$window.location.href=rejection.data.redirectUrl:$window.location.href=rejection.data.redirectUrl+$location.url():account.setSubscription(!1)),deferred.reject(rejection)}]),deferred.promise}}}]),angular.module("user").factory("user.player",["$q","$http","$state","skills.manager","lodash",function($q,$http,$state,skillsManager,lodash){var getClan,getDetails,getSearchedDetails,player,playerTidy,returnPlayerDetails,returnSearchedDetails,searchedPlayer,skillLoop;return player={},searchedPlayer={},playerTidy=function(object){if(object.name&&(object.urlName=object.name.replace(/\s+/g,"+"),object.avatar="https://secure.runescape.com/m=avatar-rs/"+object.urlName+"/chat.png"),!object.activities)return object.activities=null},skillLoop=function(object){var skills;return skills=[],lodash.forEach(object.skillvalues,function(result){var skill;if(skill=skillsManager.getSkill(result.id))return skills.push({id:result.id,icon:skill.name.toLowerCase(),level:result.level,name:skill.name,xp:.1*result.xp,rank:result.rank})}),object.skillvalues=skills},getClan=function(playerName,object){if(0===lodash.size(object.clan))return $http.jsonp('https://secure.runescape.com/m=website-data/playerDetails.ws?membership=true&names=["'+playerName+'"]&callback=JSON_CALLBACK&_=1448901242774').then(function(response){var clan;return clan=response.data[0],clan.clan&&(clan.url="http://services.runescape.com/m=clan-home/clan/"+clan.clan,clan.banner="https://secure.runescape.com/m=avatar-rs/"+clan.name.replace(/\s+/g,"+")+"/ownclan.png"),object.clan=clan},function(response){return response.status})},getDetails=function(){var deferred;return deferred=$q.defer(),0===lodash.size(player)?$http.get("/profile/profile?activities=20",{withCredentials:!0}).then(function(response){return player=response.data,"object"==typeof player&&(playerTidy(player),player.playtime=player.playtimedays+" days, "+player.playtimehours+" hours"),getClan(player.name,player),skillLoop(player),deferred.resolve(player)},function(response){return deferred.reject(response.status)}):deferred.resolve(player),deferred.promise},getSearchedDetails=function(user){var deferred;return deferred=$q.defer(),user.length>15&&$state.go("search-error",{error:"TOO_LONG"}),/^\s+$/.test(user)&&$state.go("search-error",{error:"ONLY_WHITESPACE"}),searchedPlayer.name&&searchedPlayer.name.toLowerCase()===user.toLowerCase()?deferred.resolve(searchedPlayer):$http.get("/profile/profile?user="+user+"&activities=20",{withCredentials:!0}).then(function(response){return searchedPlayer=response.data,searchedPlayer.error&&$state.go("search-error",{error:searchedPlayer.error}),searchedPlayer.name?(playerTidy(searchedPlayer),getClan(searchedPlayer.name,searchedPlayer),skillLoop(searchedPlayer),deferred.resolve(searchedPlayer)):deferred.reject(response.status)},function(response){return deferred.reject(response.status)}),deferred.promise},returnSearchedDetails=function(){return searchedPlayer},returnPlayerDetails=function(){return player},{getDetails:getDetails,getSearchedDetails:getSearchedDetails,returnSearchedDetails:returnSearchedDetails,returnPlayerDetails:returnPlayerDetails}}]),angular.module("user").controller("UserLogoutController",["$scope","user.account","$window",function($scope,account,$window){return account.logout().then(function(data){return $window.location.href=data.redirectUrl})}]),angular.module("user-menu",[]),angular.module("user-menu").factory("user-menu.manager",["overlay.manager",function(overlayManager){var closeUserMenu,getMenuState,toggleUserMenu,userMenuIsShown;return userMenuIsShown=!1,toggleUserMenu=function(){return userMenuIsShown=!userMenuIsShown,overlayManager.setOverlayState(userMenuIsShown)},closeUserMenu=function(){return userMenuIsShown=!1,overlayManager.setOverlayState(userMenuIsShown)},getMenuState=function(){return userMenuIsShown},{toggleUserMenu:toggleUserMenu,closeUserMenu:closeUserMenu,getMenuState:getMenuState}}]),angular.module("graphs",[]),angular.module("graphs").factory("graphs.util",["lodash","timeline.manager",function(lodash,timelineManager){var generateBar;return generateBar=function(opt){var obj,tempDate,_opt;switch(_opt=lodash.assign({time:opt.x,zoomable:!0},opt),tempDate=_opt.x,lodash.isString(tempDate)&&(tempDate=moment.utc(tempDate,"YYYY-MM-DD")),tempDate=moment(tempDate),timelineManager.getFidelity()){case"hour":tempDate.hours(parseInt(_opt.time));break;case"minute":tempDate.minutes(parseInt(_opt.time))}return obj={x:tempDate.toDate(),y:_opt.y,zoomable:_opt.zoomable},null!=_opt.tip&&(obj.tip=_opt.tip),null!=_opt.group&&(obj.group=_opt.group),obj},{generateBar:generateBar}}]),angular.module("graphs").factory("graphs.composite",["timeline.manager","timeline.util","$rootScope","lodash","skills.manager","graphs.util","CONFIG","$filter",function(timelineManager,timelineUtil,$rootScope,lodash,skillsManager,graphsUtil,CONFIG,$filter){var CompositeGraph,create;return CompositeGraph=function(){function CompositeGraph(opt){this._opt=lodash.assign({element:"#chart",lines:[],bars:[],transition:0,height:370,mirrorYAxis:!1},opt),this._chart=dc.compositeChart(this._opt.element),this._tooltip={},this._groups=[],this._startDate=moment(this._opt.dateRange.start),this._endDate=moment(this._opt.dateRange.end),this._init()}return CompositeGraph.prototype._initTooltips=function(){return $(".d3-tip").remove(),this._tooltip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(_this){return function(details){return _this._tip(details)}}(this))},CompositeGraph.prototype._tip=function(details){var clickMessage,content,header,html,momentX,per;switch(html="",details.tip.type){case"simple":header="<div class='d3-tip__heading'><i class='fa fa-bar-chart'></i> "+details.tip.text+"</div>",per="<div class='d3-tip__xp'"+$filter("number")(details.y),null!=details.tip.append&&(per+=" "+details.tip.append),per+="</div>",html=header+per;break;case"skill":case"time":case"icon":switch(content="",details.tip.type){case"skill":content="<div class='d3-tip__xp'><span class='d3-tip__skilltip d3-tip__skilltip--"+skillsManager.getSkill(details.group).name.toLowerCase()+"'></span>"+$filter("number")(details.y);break;case"icon":content="<div class='d3-tip__xp'><span class='d3-tip__icontip'><img src='"+CONFIG.CONTEXT+"/"+details.tip.icon+"' /></span>"+$filter("number")(details.y);break;default:content="<div class='d3-tip__xp'>"+$filter("number")(details.y)}switch(null!=details.tip.append&&(content+=" "+details.tip.append),content+="</div>",null==details.tip.reward&&null==details.tip.bonus||(details.tip.reward=parseInt(details.tip.reward),details.tip.bonus=parseInt(details.tip.bonus),content+="<div class='d3-tip__bonus-wrap'>",details.tip.reward>0&&(content+="<span class='d3-tip__reward'>"+$filter("number")(details.tip.reward)+" Reward XP</span>"),details.tip.bonus>0&&(content+="<span class='d3-tip__bonus'>"+$filter("number")(details.tip.bonus)+" Bonus XP</span>"),content+="</div>"),clickMessage="<div class='d3-tip__more'>",details.zoomable&&(clickMessage+="<i class='fa fa-clock-o'></i> Click for hourly stats"),clickMessage+="</div>",momentX=moment.utc(details.x),this._opt.fidelity){case"month":html="<time class='d3-tip__time'><i class='fa fa-calendar-o'></i>  "+moment(details.x).format("MMM YYYY")+"</time>"+content;break;case"hour":details.preview?clickMessage="<div class='d3-tip__more'><i class='fa fa-calendar-o'></i> Click to see "+momentX.format("DD MMMM")+"</div>":(clickMessage="<div class='d3-tip__more'>",details.zoomable&&(clickMessage+="<i class='fa fa-clock-o'></i> Click for minute stats"),clickMessage+="</div>"),
html="<time class='d3-tip__time'><i class='fa fa-clock-o'></i> "+momentX.format("hh:mm a")+"</time>"+content+clickMessage;break;case"minute":details.x.getUTCMinutes(),clickMessage=details.preview?"<div class='d3-tip__more'><i class='fa fa-clock-o'></i> Click to see "+momentX.format("hh:mm a")+"</div>":"",html="<time class='d3-tip__time'><i class='fa fa-clock-o'></i> "+momentX.format("hh:mm a")+"</time>"+content+clickMessage;break;default:html="<time class='d3-tip__time'><i class='fa fa-calendar-o'></i>  "+momentX.format("ddd DD MMM YYYY")+"</time>"+content+clickMessage}}return html},CompositeGraph.prototype._barClick=function(details){var dateObj,end,start;if(details.preview||"day"===this._opt.fidelity||"hour"===this._opt.fidelity)return this._tooltip.hide(),start=moment.utc(details.x),end=moment.utc(details.x),"day"===this._opt.fidelity&&end.endOf("day"),"hour"===this._opt.fidelity&&details.preview&&(start.startOf("day"),end.endOf("day")),("minute"===this._opt.fidelity&&details.preview||"hour"===this._opt.fidelity&&!details.preview)&&(start.startOf("hour"),end.endOf("hour")),dateObj={start:start,end:end},$rootScope.$apply(function(){return timelineManager.setActiveDate(dateObj)})},CompositeGraph.prototype._renderGraphHorizontalBars=function(){var height,position;if(!this._chart.select(".grid-line.horizontal line").empty()&&(height=this._chart.select(".grid-line.horizontal line:first-child").attr("y1")-this._chart.select(".grid-line.horizontal line:nth-child(2)").attr("y1"),position=height/2,this._chart.selectAll(".grid-line.horizontal line:nth-child(even)").each(function(d,i){var line,tempPosition;return line=d3.select(this),tempPosition=parseInt(line.attr("y1"))-position,line.attr("stroke-width",height).attr("y1",tempPosition).attr("y2",tempPosition).attr("class","bar-chart__horizontal-bars")}),this._chart.select(".grid-line.horizontal line:last-child").attr("y1")<position))return height=parseInt(this._chart.select(".grid-line.horizontal line:last-child").attr("stroke-width")/2)+parseInt(this._chart.select(".grid-line.horizontal line:last-child").attr("y1")),position=height/2,this._chart.select(".grid-line.horizontal line:last-child").attr("stroke-width",height).attr("y1",position+1).attr("y2",position+1)},CompositeGraph.prototype._renderGraphBackground=function(){return this._chart.select(".grid-line.vertical").insert("rect",":first-child").attr("class","bar-chart__bg").attr({width:this._chart.xAxisLength()-1,height:this._chart.yAxisHeight()})},CompositeGraph.prototype._setupXAxis=function(){var prevTickDate,units;switch(units={},this._opt.fidelity){case"minute":units=d3.time.minutes.utc;break;case"hour":units=d3.time.hours.utc;break;case"day":units=d3.time.days.utc;break;case"month":units=function(){return 15}}return this._chart.x(d3.time.scale.utc().domain([this._startDate.toDate(),this._endDate.toDate()])).xUnits(units),"day"===this._opt.fidelity?(prevTickDate=null,this._chart.xAxis().ticks(3).tickFormat(function(currTick){var currTickDate,display;return display="",currTickDate=moment(currTick),currTickDate.isSame(prevTickDate,"day")||(display=currTickDate.format("DD MMM"),!lodash.isNull(prevTickDate)&&currTickDate.isSame(prevTickDate,"month")&&(display=currTickDate.format("DD")),prevTickDate=currTickDate),display})):this._chart.xAxis().ticks(3)},CompositeGraph.prototype._splitBars=function(){var barWidth,numGroups;if(this._chart.select(".bar").node()&&this._groups.length>1)return numGroups=this._groups.length,barWidth=this._chart.select(".bar").node().getBBox().width/this._groups.length,this._chart.selectAll(".bar").attr("width",barWidth),function(){var _results;for(_results=[];numGroups-=1;)_results.push(this._chart.selectAll(".sub._"+numGroups+" .bar").attr("x",function(){return this.getBBox().x+barWidth*numGroups}));return _results}.call(this)},CompositeGraph.prototype._attachEvents=function(){return this._chart.on("renderlet",function(_this){return function(chart){return _this._renderGraphBackground(),_this._renderGraphHorizontalBars(),(_this._opt.bars.length>0||_this._opt.lines.length>0)&&d3.selectAll(".sub rect.bar, .sub path.line").call(_this._tooltip),_this._groups.length>1&&_this._splitBars(),chart.selectAll(".sub rect.bar").on("mouseover",function(d){var bar;if(bar=d.data.value,null!=bar.tip)return _this._tooltip.show(bar)}).on("mouseout",function(d){var bar;if(bar=d.data.value,null!=bar.tip)return _this._tooltip.hide()}).on("click",function(d){if(d.data.value.zoomable)return _this._barClick(d.data.value)}).attr("class",function(d){var bar;return bar=d.data.value,"",bar.preview?"bar bar--click bar--prev-nxt":"minute"===_this._opt.fidelity?"bar bar--non-click":d.data.value.zoomable?"bar bar--click":"bar bar--non-click"}),chart.selectAll(".sub path.line").on("mouseover",function(d){var firstPoint;if(firstPoint=d.values[0].data.value,null!=firstPoint.tip)return _this._tooltip.show(firstPoint)}).on("mouseout",function(d){var firstPoint;if(firstPoint=d.values[0].data.value,null!=firstPoint.tip)return _this._tooltip.hide()})}}(this)).on("postRender",function(_this){return function(){if(null!=_this._opt.callback)return _this._opt.callback()}}(this))},CompositeGraph.prototype._init=function(){var aboveZeroBars,amendedDate,barArray,color,groups,id,lineArray,subZeroBars,yAxis,yAxisPadding;return this._opt.adjacency>0&&(amendedDate=timelineUtil.addAdjacency(this._opt.adjacency,this._opt.dateRange),this._startDate=moment(amendedDate.start),this._endDate=moment(amendedDate.end)),groups=[],lodash.each(this._opt.bars.concat(this._opt.lines),function(item){if(null!=item.group)return groups.push(item.group)}),lodash.each(lodash.uniq(groups),function(_this){return function(id){var color;return color=skillsManager.getSkill(id).color,_this._groups.push({id:id,color:color})}}(this)),0===this._groups.length&&(id=0,color=skillsManager.getSkill(id).color,this._groups.push({id:id,color:color}),lodash.each(this._opt.bars,function(bar){return bar.group=id})),yAxis={bottom:0,top:0},barArray=[],lodash.each(this._groups,function(_this){return function(group){var barGroup,bars,barsDimension,dateRange;bars=lodash.filter(_this._opt.bars,function(bar){return bar.group===group.id}),barsDimension=crossfilter(bars).dimension(function(d){var tempDate;return tempDate=new Date(d.x),new Date(tempDate.getTime())}),dateRange=_this._opt.dateRange,barGroup=barsDimension.group().reduce(function(p,v){return v.y=Math.floor(v.y),v.y>yAxis.top&&(yAxis.top=v.y),v.y<yAxis.bottom&&(yAxis.bottom=v.y),v.preview=v.x<dateRange.start||v.x>=dateRange.end,v},function(p,v){return v.y=Math.floor(v.y),v.preview=v.x<dateRange.start||v.x>=dateRange.end,v},function(){return{}}),barArray.push(dc.barChart(_this._chart).dimension(barsDimension).colors(group.color).group(barGroup).valueAccessor(function(p){return p.value.y})),barGroup.all()}}(this)),subZeroBars=lodash.find(this._opt.bars,function(bar){return bar.y<0}),aboveZeroBars=lodash.find(this._opt.bars,function(bar){return bar.y>0}),(subZeroBars&&aboveZeroBars||this._opt.mirrorYAxis)&&this._opt.lines.push({color:"#496374",points:[{x:this._startDate,y:0},{x:this._endDate,y:0}]}),lineArray=[],lodash.each(this._opt.lines,function(_this){return function(line){var chart,lineGroup,linesDimension,points;points=[],lodash.each(line.points,function(point){var obj;return obj={x:point.x,y:point.y},null!=line.group&&(obj.group=line.group),null!=line.tip&&(obj.tip=line.tip),points.push(obj)}),linesDimension=crossfilter(points).dimension(function(d){return d.x}),lineGroup=linesDimension.group().reduce(function(p,v){return v.y>yAxis.top&&(yAxis.top=v.y),v.y<yAxis.bottom&&(yAxis.bottom=v.y),v},function(p,v){return v},function(){return{}}),null!=line.color?color=line.color:null!=line.group&&(color=lodash.result(lodash.findWhere(_this._groups,{id:line.group}),"color")),chart=dc.lineChart(_this._chart).dimension(linesDimension).colors(color).group(lineGroup).valueAccessor(function(p){return p.value.y}),null!=line.style&&chart.dashStyle(line.style),null!=line.dots&&chart.dotRadius(line.dots),lineArray.push(chart),lineGroup.all()}}(this)),yAxisPadding=10,yAxis.bottom=yAxis.bottom+yAxis.bottom/100*yAxisPadding,yAxis.top=yAxis.top+yAxis.top/100*yAxisPadding,this._opt.mirrorYAxis&&(Math.abs(yAxis.bottom)>yAxis.top?yAxis.top=Math.abs(yAxis.bottom):yAxis.bottom=-yAxis.top),this._chart.title(function(){return""}).margins({top:20,right:20,bottom:20,left:85}).height(this._opt.height).brushOn(!1).y(d3.scale.linear().domain([yAxis.bottom,yAxis.top])).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).transitionDuration(this._opt.transition).compose(barArray.concat(lineArray)),this._setupXAxis(),this._initTooltips(),this._attachEvents(),this._chart.render()},CompositeGraph}(),create=function(opt){return new CompositeGraph(opt)},{create:create}}]),angular.module("graphs").factory("graphs.pie",[function(){var drawPie;return drawPie=function(segments){var chart,ndx,runDimension,speedSumGroup;return ndx=crossfilter(segments),runDimension=ndx.dimension(function(d){return d.name}),speedSumGroup=runDimension.group().reduceSum(function(d){return d.val}),chart=dc.pieChart("#pie-chart"),chart.height(150).innerRadius(45).dimension(runDimension).group(speedSumGroup).renderLabel(!1).ordinalColors(["#e1bb34","#34bdd1","#c52037"]).transitionDuration(0).filter=function(){return{}},chart.render()},{drawPie:drawPie}}]),angular.module("player-bar",[]),angular.module("player-bar").directive("playerBar",["$rootScope","$state","user.player",function($rootScope,$state,userPlayer){var link;return link=function(scope,element,attr){var displayUserBar;return displayUserBar=function(player){return $state.current.data.searched?scope.searchedUser=player:scope.searchedUser=!1},scope.$watch(function(){return userPlayer.returnSearchedDetails()},function(player){return displayUserBar(player)}),$rootScope.$on("$stateChangeSuccess",function(){return displayUserBar(userPlayer.returnSearchedDetails())})},{link:link,restrict:"E",scope:{},templateUrl:"/template/player-bar/player-bar.ftl"}}]),angular.module("overview",[]).config(function($stateProvider){return $stateProvider.state("overview",{url:"/my-profile",templateUrl:"/template/overview/overview.index.ftl",data:{title:"My Profile",timeline:!1,settings:!1}}).state("overview-searched-user",{url:"/overview/player/:username",templateUrl:"/template/overview/overview.searched-user.ftl",controller:"OverviewSearchedUser",data:{title:"Overview",subscribe:!1,settings:!1,timeline:!1,reqAuth:!1,searched:!0}})}),angular.module("overview").controller("OverviewSearchedUser",["$stateParams","$rootScope","$state","user.player",function($stateParams,$rootScope,$state,userPlayer){return userPlayer.getSearchedDetails($stateParams.username).then(function(playerDetails){return $rootScope.searchedPlayer=playerDetails})}]),angular.module("overview").directive("player",["$state","user.player",function($state,userPlayer){var link;return link=function(scope,element,attr){if(userPlayer.getDetails().then(function(response){return scope.player=response}),"overview-searched-user"===$state.current.name)return userPlayer.getSearchedDetails($state.params.username).then(function(response){return scope.player=response})},{link:link,restrict:"E",scope:{},templateUrl:"/template/overview/overview.player.ftl"}}]),angular.module("overview").directive("skills",["$state","user.player",function($state,userPlayer){var link;return link=function(scope,element,attr){if(scope.searched=!1,userPlayer.getDetails().then(function(response){return scope.player=response}),"overview-searched-user"===$state.current.name)return scope.searched=!0,userPlayer.getSearchedDetails($state.params.username).then(function(response){return scope.player=response})},{link:link,restrict:"E",scope:{},templateUrl:"/template/overview/overview.skills.ftl"}}]),angular.module("overview").directive("activity",["$state","user.player",function($state,userPlayer){var link;return link=function(scope,element,attr){if(scope.searched=!1,userPlayer.getDetails().then(function(response){return scope.player=response}),"overview-searched-user"===$state.current.name)return scope.searched=!0,userPlayer.getSearchedDetails($state.params.username).then(function(response){return scope.player=response})},{link:link,restrict:"E",scope:{},templateUrl:"/template/overview/overview.activity.ftl"}}]),angular.module("overview").directive("clan",["$state","user.player",function($state,userPlayer){var link;return link=function(scope,element,attr){if(scope.searched=!1,userPlayer.getDetails().then(function(response){return scope.player=response}),"overview-searched-user"===$state.current.name)return scope.searched=!0,userPlayer.getSearchedDetails($state.params.username).then(function(response){return scope.player=response})},{link:link,restrict:"E",scope:{},templateUrl:"/template/overview/overview.clan.ftl"}}]),angular.module("overview").directive("quests",["$state","user.player","graphs.pie","shared.screen-size",function($state,userPlayer,graphsPie,screenSize){var link;return link=function(scope,element,attr){var drawPie;return scope.searched=!1,scope.player=null,userPlayer.getDetails().then(function(response){return scope.player=response,drawPie(scope.player)}),"overview-searched-user"===$state.current.name&&(scope.searched=!0,userPlayer.getSearchedDetails($state.params.username).then(function(response){return scope.player=response,drawPie(scope.player)})),drawPie=function(player){var segments;return segments=[{name:"Quests Complete",val:player.questscomplete},{name:"Quests in progress",val:player.questsstarted},{name:"Quests not started",val:player.questsnotstarted}],graphsPie.drawPie(segments)},scope.$watch(function(){return screenSize.getWidth()},function(){if(scope.player)return drawPie(scope.player)})},{link:link,restrict:"E",scope:{},templateUrl:"/template/overview/overview.quests.ftl"}}]),angular.module("summary",[]),angular.module("summary").directive("summaryIndex",["timeline.manager",function(timelineManager){var link;return link=function(scope,element,attr){var closeOthers;return closeOthers=function(dontClose){if(scope.mainMenuActive&&"main"!==dontClose&&!screenSize.getMedia().isLargeUp&&(scope.mainMenuActive=mainMenuManager.toggleMainMenu()),scope.settingsMenuActive&&"settings"!==dontClose&&(scope.settingsMenuActive=settingsManager.toggleMenu()),scope.timelinePickerActive&&"picker"!==dontClose&&(scope.timelinePickerActive=timelineManager.togglePicker()),scope.userMenuActive&&"user"!==dontClose)return scope.userMenuActive=userMenuManager.toggleUserMenu()},scope.toggleTimelinePicker=function(){return closeOthers("picker"),scope.timelinePickerActive=timelineManager.togglePicker()},scope.$watch(function(){return timelineManager.getPickerState()},function(state){return closeOthers("picker"),scope.timelinePickerActive=state})},{link:link,restrict:"E",scope:{},templateUrl:"/template/summary/summary.index.ftl"}}]),angular.module("summary").directive("summaryXpGain",["lodash","graphs.composite","timeline.manager","xp-gains.manager","skills.manager","settings.manager","shared.screen-size","graphs.util","timeline.util","$state",function(lodash,graphsBar,timelineManager,xpGainsManager,skillsManager,settingsManager,screenSize,graphsUtil,timelineUtil,$state){var chart,chartDrawn,date,graphOptions,link;return chart=null,chartDrawn=!1,graphOptions={},date=timelineManager.getActiveDate(),link=function(scope,element,attr){var draw,fetch;return fetch=function(){var dateRange,fidelity,skillsArray;return date=timelineManager.getActiveDate(),skillsArray=skillsManager.setActiveSkills([-1]),dateRange={start:moment(date.start),end:moment(date.end)},fidelity=timelineManager.getFidelity(),scope.noData=!1,xpGainsManager.getGainPeriod(dateRange,skillsArray,fidelity).then(function(response){var append,bars,lines;switch(scope.total=response.data[0].total,scope.average=response.data[0].average,bars=[],lines=[],append="",fidelity){case"hour":append="XP/hr";break;case"minute":append="XP/min";break;default:append="XP/day"}return scope.fidelity=append,lodash.forEach(response.data,function(group){var id;if(id=group.skill,null!=group.requested)return"day"===fidelity?lodash.each(group.requested,function(bar){return bars.push(graphsUtil.generateBar({group:id,x:bar.day,y:.1*bar.total.xp,zoomable:!1}))}):lodash.each(group.requested,function(val,time){return bars.push(graphsUtil.generateBar({group:id,time:time,x:dateRange.start,y:parseInt(.1*val.xp),zoomable:!1}))})}),graphOptions={dateRange:dateRange,fidelity:fidelity,lines:lines,bars:bars,scope:scope,height:230,callback:function(){return chartDrawn=!0}},draw()},function(){if(chart)return chart.remove(),chart=null}),scope.noData=!0},draw=function(){return chart=graphsBar.create(graphOptions)},scope.chartLink=function(){return $state.go("xp-gains-graph",{skills:-1})},scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue,oldValue){return fetch()}),scope.$watch(function(){return screenSize.getWidth()},function(){if(chartDrawn)return draw()})},{link:link,restrict:"E",scope:{},templateUrl:"/template/summary/summary.xp-gain.ftl"}}]),angular.module("summary").directive("summarySplit",["$filter","ngTableParams","lodash","timeline.manager","xp-gains.manager",function($filter,ngTableParams,lodash,timelineManager,xpGainsManager){var link;return link=function(scope,element,attr){var createSkillTable,date;return date=timelineManager.getActiveDate(),createSkillTable=function(){return"minute"===timelineManager.getFidelity()&&timelineManager.roundToDay(date),xpGainsManager.getSkillTotals(timelineManager.getActiveDate()).then(function(response){var overallTemp,tempArray;return tempArray=response.data,overallTemp=lodash.find(tempArray,{id:-1}),lodash.remove(tempArray,overallTemp),scope.overall={icon:overallTemp.icon,id:overallTemp.id,simple:overallTemp.simple,skill:overallTemp.skill,total:overallTemp.total},scope.tableSkills=tempArray,scope.tableParams=new ngTableParams({page:1,count:6,sorting:{total:"desc"}},{counts:[],getData:function($defer,params){return scope.tableSkills=$filter("orderBy")(scope.tableSkills,params.orderBy()),$defer.resolve(scope.tableSkills.slice((params.page()-1)*params.count(),params.page()*params.count()))}})})},scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue,oldValue){return createSkillTable()})},{link:link,restrict:"E",scope:{},templateUrl:"/template/summary/summary.xp-split.ftl"}}]),angular.module("summary").directive("summaryKills",["pvm-kills.manager","ngTableParams","lodash","$filter","timeline.manager",function(pvmKillsManager,ngTableParams,lodash,$filter,timelineManager){var link;return link=function(scope,element,attr){var fetch;return fetch=function(date,fidelity){var dateRange;return dateRange={start:moment(date.start),end:moment(date.end)},pvmKillsManager.getPVMPeriod(dateRange,fidelity).then(function(){var data,total;if(data=pvmKillsManager.getData(),null!=data.kills)return scope.myValues=data.monsters,total=0,lodash.each(data.kills,function(segment){return total+=segment.total}),scope.kills=$filter("number")(total),scope.tableParams=new ngTableParams({sorting:{kills:"desc"}},{counts:[],getData:function($defer,params){return scope.myValues=$filter("orderBy")(scope.myValues,params.orderBy()).splice(0,6),$defer.resolve(scope.myValues)}})})},scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue,oldValue){var date,fidelity;return date=newValue,fidelity=timelineManager.getFidelity(),fetch(date,fidelity)})},{link:link,restrict:"E",scope:{},templateUrl:"/template/summary/summary.kills.ftl"}}]),angular.module("summary").directive("summaryDropLog",["drop-log.manager","timeline.manager","ngTableParams","$filter","lodash",function(dropLogManager,timelineManager,ngTableParams,$filter,lodash){var link;return link=function(scope,element,attr){var date,fetch,monsterId;return date=timelineManager.getActiveDate(),monsterId=0,fetch=function(){var dateRange,fidelity,tempData;return tempData=[],dateRange={start:moment(date.start),end:moment(date.end)},"minute"===timelineManager.getFidelity&&(dateRange={start:dateRange.start.startOf("day"),end:dateRange.end.endOf("day")},timelineManager.setActiveDate(dateRange)),fidelity=timelineManager.getFidelity(),dropLogManager.getDropPeriod({date:dateRange,fidelity:fidelity},monsterId).then(function(data){var sumTotal,totalValue;return delete data.name,tempData=[],sumTotal=lodash.map(data,"totalValue"),totalValue=lodash.sum(sumTotal),lodash.forEach(data,function(value,key){return tempData.push(value)}),scope.values=tempData,scope.tableData=tempData,scope.total=totalValue,scope.tableParams=new ngTableParams({sorting:{quantity:"desc"}},{counts:[],getData:function($defer,params){return scope.tableData=$filter("orderBy")(scope.tableData,params.orderBy()).splice(0,6),$defer.resolve(scope.tableData.splice(0,6))}})})},scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue,oldValue){return date=newValue,fetch()})},{link:link,restrict:"E",scope:{},templateUrl:"/template/summary/summary.drop-log.ftl"}}]),angular.module("summary").directive("summaryWealth",["lodash","timeline.manager","wealth-change.manager","graphs.composite","graphs.util","shared.screen-size",function(lodash,timelineManager,wealthChangeManager,graphsBar,graphsUtil,screenSize){var link;return link=function(scope,element,attr){var chart,chartDrawn,date,draw,fetch,graphOptions;return date=timelineManager.getActiveDate(),chart=null,chartDrawn=!1,graphOptions={},fetch=function(){var dateRange,fidelity;return dateRange={start:moment(date.start),end:moment(date.end)},fidelity=timelineManager.getFidelity(),wealthChangeManager.getChangePeriod(dateRange,fidelity).then(function(response){var bars,data,lines;return bars=[],lines=[],data=response.data,scope.average=0,scope.average=0,scope.fidelity=fidelity,null!=data.average&&(scope.average=data.average),null!=data.total&&(scope.net=data.total),null!=data&&("day"===fidelity?lodash.each(data.requested.change,function(bar){return bars.push(graphsUtil.generateBar({group:-1,x:bar.day,y:bar.total,zoomable:!1}))}):lodash.each(data.requested,function(total,time){return bars.push(graphsUtil.generateBar({group:-1,time:time,x:dateRange.start,y:total,zoomable:!1}))})),graphOptions={element:"#summary-wealth-chart",dateRange:dateRange,fidelity:fidelity,lines:lines,bars:bars,mirrorYAxis:!0,scope:scope,height:230,callback:function(){return chartDrawn=!0}},draw()},function(){if(chart)return chart.remove(),chart=null})},draw=function(){return chart=graphsBar.create(graphOptions)},scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newDate,oldDate){return date=newDate,fetch()}),scope.$watch(function(){return screenSize.getWidth()},function(){if(chartDrawn)return draw()})},{link:link,restrict:"E",scope:{},templateUrl:"/template/summary/summary.wealth.ftl"}}]),angular.module("skills",[]),angular.module("skills").directive("skillsPicker",["skills.manager","$timeout","lodash","$state",function(skillsManager,$timeout,lodash,$state){var link;return link=function(scope,element,attr){var SKILLS,pickerAction,showHide;return SKILLS=skillsManager.SKILLS,SKILLS=lodash.sortBy(SKILLS,"name"),scope.options=SKILLS,scope.select=skillsManager.getActiveSkills(),pickerAction=!0,showHide=function(){return scope.select.length<5?element.show():element.hide()},$timeout(function(){var placeholder;return angular.element(".skill-picker").chosen({max_selected_options:5,width:"100%"}),placeholder=angular.element(".skill-picker").data("placeholder"),element.prepend('<span class="chosen-placeholder">'+placeholder+"</span>"),element.css("position","relative")},0,!1),angular.element(".skill-picker").bind("chosen:showing_dropdown",function(){return angular.element(".chosen-placeholder").hide()}),angular.element(".skill-picker").bind("chosen:hiding_dropdown",function(){return angular.element(".chosen-placeholder").show()}),scope.$watch("select",function(skills){var ids;return pickerAction=!0,ids=lodash.map(skills,function(skill){return skill.id}),skillsManager.setActiveSkills(ids)}),scope.$watch(function(){return skillsManager.getActiveSkills()},function(newValue){return!1===pickerAction?scope.select=newValue:pickerAction=!1,showHide()})},{link:link,restrict:"E",scope:{},templateUrl:"/template/skills/skills.picker.ftl"}}]),angular.module("skills").factory("skills.manager",function(lodash){var LEVELS,MASTERLEVELS,SKILLS,activeSkills,getActiveSkills,getAllSkills,getSkill,removeFromActiveSkills,setActiveSkills;return SKILLS=[{id:-1,name:"Overall",color:"#e1bb34"},{id:0,name:"Attack",color:"#981414"},{id:1,name:"Defence",color:"#147e98"},{id:2,name:"Strength",color:"#13b787"},{id:3,name:"Constitution",color:"#AACEDA"},{id:4,name:"Ranged",color:"#13b751"},{id:5,name:"Prayer",color:"#6dbff2"},{id:6,name:"Magic",color:"#c3e3dc"},{id:7,name:"Cooking",color:"#553285"},{id:8,name:"Woodcutting",color:"#7e4f35"},{id:9,name:"Fletching",color:"#149893"},{id:10,name:"Fishing",color:"#3e70b9"},{id:11,name:"Firemaking",color:"#f75f28"},{id:12,name:"Crafting",color:"#b6952c"},{id:13,name:"Smithing",color:"#65887e"},{id:14,name:"Mining",color:"#56495e"},{id:15,name:"Herblore",color:"#12453a"},{id:16,name:"Agility",color:"#284A95"},{id:17,name:"Thieving",color:"#36175e"},{id:18,name:"Slayer",color:"#48412f"},{id:19,name:"Farming",color:"#1f7d54"},{id:20,name:"Runecrafting",color:"#d7eba3"},{id:21,name:"Hunter",color:"#c38b4e"},{id:22,name:"Construction",color:"#a8babc"},{id:23,name:"Summoning",color:"#DEA1B0"},{id:24,name:"Dungeoneering",color:"#723920",maxLevel:120},{id:25,name:"Divination",color:"#943fba"},{id:26,name:"Invention",color:"#f7b528",skillCurve:"master"}],activeSkills=[lodash.where(SKILLS,{id:-1})[0]],LEVELS={1:0,2:83,3:174,4:276,5:388,6:512,7:650,8:801,9:969,10:1154,11:1358,12:1584,13:1833,14:2107,15:2411,16:2746,17:3115,18:3523,19:3973,20:4470,21:5018,22:5624,23:6291,24:7028,25:7842,26:8740,27:9730,28:10824,29:12031,30:13363,31:14833,32:16456,33:18247,34:20224,35:22406,36:24815,37:27473,38:30408,39:33648,40:37224,41:41171,42:45529,43:50339,44:55649,45:61512,46:67983,47:75127,48:83014,49:91721,50:101333,51:111945,52:123660,53:136594,54:150872,55:166636,56:184040,57:203254,58:224466,59:247886,60:273742,61:302288,62:333804,63:368599,64:407015,65:449428,66:496254,67:547953,68:605032,69:668051,70:737627,71:814445,72:899257,73:992895,74:1096278,75:1210421,76:1336443,77:1475581,78:1629200,79:1798808,80:1986068,81:2192818,82:2421087,83:2673114,84:2951373,85:3258594,86:3597792,87:3972294,88:4385776,89:4842295,90:5346332,91:5902831,92:6517253,93:7195629,94:7944614,95:8771558,96:9684577,97:10692629,98:11805606,99:13034431,100:14391160,101:15889109,102:17542976,103:19368992,104:21385073,105:23611006,106:26068632,107:28782069,108:31777943,109:35085654,110:38737661,111:42769801,112:47221641,113:52136869,114:57563718,115:63555443,116:70170840,117:77474828,118:85539082,119:94442737,120:104273167,121:115126838,122:127110260,123:140341028,124:154948977,125:171077457,126:188884740,127:2e8},MASTERLEVELS={1:0,2:830,3:1861,4:2902,5:3980,6:5126,7:6380,8:7787,9:9400,10:11275,11:13605,12:16372,13:19656,14:23546,15:28134,16:33520,17:39809,18:47109,19:55535,20:65209,21:77190,22:90811,23:106221,24:123573,25:143025,26:164742,27:188893,28:215651,29:245196,30:277713,31:316311,32:358547,33:404634,34:454796,35:509259,36:568254,37:632019,38:700797,39:774834,40:854383,41:946227,42:1044569,43:1149696,44:1261903,45:1381488,46:1508756,47:1644015,48:1787581,49:1939773,50:2100917,51:2283490,52:2476369,53:2679917,54:2894505,55:3120508,56:3358307,57:3608290,58:3870846,59:4146374,60:4435275,61:4758122,62:5096111,63:5449685,64:5819299,65:6205407,66:6608473,67:7028964,68:7467354,69:7924122,70:8399751,71:8925664,72:9472665,73:10041285,74:10632061,75:11245538,76:11882262,77:12542789,78:13227679,79:13937496,80:14672812,81:15478994,82:16313404,83:17176661,84:18069395,85:18992239,86:19945833,87:20930821,88:21947856,89:22997593,90:24080695,91:25259906,92:26475754,93:27728955,94:29020233,95:30350318,96:31719944,97:33129852,98:34580790,99:36073511,100:37608773,101:39270442,102:40978509,103:42733789,104:44537107,105:46389292,106:48291180,107:50243611,108:52247435,109:54303504,110:56412678,111:58575824,112:60793812,113:63067521,114:65397835,115:67785643,116:70231841,117:72737330,118:75303019,119:77929820,120:80618654,121:83370445,122:86186124,123:89066630,124:92012904,125:95025896,126:98106559,127:101255855,128:104474750,129:107764216,130:111125230,131:114558777,132:118065845,133:121647430,134:125304532,135:129038159,136:132849323,137:136739041,138:140708338,139:144758242,140:148889790,141:153104021,142:157401983,143:161784728,144:166253312,145:170808801,146:175452262,147:180184770,148:185007406,149:189921255,150:194927409,151:2e8},getSkill=function(skillId){var skill;return skill=lodash.find(SKILLS,"id",skillId),skill||(skill=lodash.find(SKILLS,"id",-1)),skill},getAllSkills=function(){return SKILLS},removeFromActiveSkills=function(id){return activeSkills=lodash.remove(activeSkills,function(skill){return skill.id!==id})},setActiveSkills=function(skillsArray){var setSkills,skill,_i,_len;for(activeSkills=[],setSkills=function(skillId){return activeSkills.push(lodash.where(SKILLS,{id:skillId})[0])},_i=0,_len=skillsArray.length;_i<_len;_i++)skill=skillsArray[_i],setSkills(skill);return activeSkills},getActiveSkills=function(){return activeSkills},{getSkill:getSkill,getAllSkills:getAllSkills,removeFromActiveSkills:removeFromActiveSkills,SKILLS:SKILLS,LEVELS:LEVELS,MASTERLEVELS:MASTERLEVELS,setActiveSkills:setActiveSkills,getActiveSkills:getActiveSkills}}),angular.module("breadcrumb",[]),angular.module("breadcrumb").directive("breadcrumbSelect",["timeline.manager","lodash",function(timelineManager,lodash){var link,prevRange;return prevRange=null,link=function(scope,element,attrs){return scope.setDate=function(date){return timelineManager.setActiveDate(date)},scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(date){var difference,end,range,start;return scope.links=[],range=null,range=date.end.isAfter(date.start,"day")?"range":timelineManager.getFidelity(),"range"===range&&(prevRange=null),prevRange&&(difference=prevRange.end.diff(prevRange.start,"days"),difference+=1,scope.links.push({text:difference+" Days",date:prevRange})),"hour"===range?scope.current=timelineManager.getHumanDate(date):"minute"===range?(start=moment(date.start),end=moment(date.end),scope.links.push({text:""+start.format("ddd DD MMM"),date:{start:start.startOf("day"),end:end.endOf("day")}}),start=moment(date.start),end=moment(date.end),scope.current=""+start.format("hh:mm a")):(difference=date.end.diff(date.start,"days"),difference+=1,scope.current=difference+" Days",prevRange=date)})},{link:link,restrict:"E",scope:{},templateUrl:"/template/breadcrumb/breadcrumb.select.ftl"}}]),angular.module("levels",[]).config(function($stateProvider){return $stateProvider.state("levels",{url:"/levels",templateUrl:"/template/levels/levels.index.ftl",data:{title:"Levels",timeline:!1,settings:!1}}).state("levels-searched-user",{url:"/levels/player/:username",templateUrl:"/template/levels/levels.index.ftl",data:{title:"Levels",timeline:!1,settings:!1,reqAuth:!1,searched:!0}})}),angular.module("levels").directive("levelsSummary",["$state","user.player","ngTableParams","$filter","lodash","skills.manager",function($state,userPlayer,ngTableParams,$filter,lodash,skillsManager){var link;return link=function(scope,element,attr){var generateLevels;return generateLevels=function(playerDetails){return scope.totalVirtualLvls=0,scope.totalXP=playerDetails.totalxp,scope.totalSkill=playerDetails.totalskill,scope.combatLevel=playerDetails.combatlevel,lodash.forEach(playerDetails.skillvalues,function(skill){var MAXXP,endVal,maxLevel,skillLevels,startVal,tempLvl;if(MAXXP=2e8,maxLevel=lodash.size(skillsManager.LEVELS),skillLevels=skillsManager.LEVELS,skill.xp=Math.floor(skill.xp),
skill.lvlTxt=skill.level,null!=skillsManager.getSkill(skill.id).skillCurve&&(skillLevels=skillsManager.MASTERLEVELS,maxLevel=lodash.size(skillsManager.MASTERLEVELS)),skill.level>=99&&(tempLvl=lodash.findKey(skillLevels,function(xp){return xp>=skill.xp}),skill.level=tempLvl-1,skill.xp===skillLevels[tempLvl]&&(skill.level=parseInt(tempLvl)),skill.lvlTxt=skill.level,skill.xp>=MAXXP&&(skill.level=parseInt(tempLvl),skill.lvlTxt="MAX")),scope.totalVirtualLvls=scope.totalVirtualLvls+skill.level,skill.color=skillsManager.getSkill(skill.id).color,skill.level<maxLevel?(skill.nextXp=skillLevels[skill.level+1]-skill.xp,skill.xp>0?(startVal=skill.xp-skillLevels[skill.level],endVal=skillLevels[skill.level+1]-skillLevels[skill.level],skill.nextPercent=0!==startVal?Math.floor(startVal/endVal*100):0):skill.nextPercent=0):(skill.nextPercent=100,skill.nextXp=0),0===skill.rank)return skill.rank=null}),scope.tableLevels=playerDetails.skillvalues,scope.tableParams=new ngTableParams({sorting:{xp:"desc"}},{counts:[],getData:function($defer,params){return scope.tableLevels=$filter("orderBy")(scope.tableLevels,params.orderBy()),$defer.resolve(scope.tableLevels)}})},"levels-searched-user"===$state.current.name?userPlayer.getSearchedDetails($state.params.username).then(function(response){return generateLevels(response)}):userPlayer.getDetails().then(function(response){return generateLevels(response)})},{link:link,restrict:"E",scope:{},templateUrl:"/template/levels/levels.summary.ftl"}}]),angular.module("loading",[]),angular.module("loading").directive("loading",["$http","loading.manager",function($http,loadingManager){var link;return link=function(scope,element,attr){return scope.$watch(function(){return loadingManager.isLoading()},function(v){return v?(element.show(),angular.element(".summary-row").hide()):(element.hide(),angular.element(".summary-row").fadeIn(500))})},{link:link,restrict:"E",scope:{},templateUrl:"/template/loading/loading.graphic.ftl"}}]),angular.module("loading").factory("loading.manager",["$http",function($http){var isLoading;return isLoading=function(){return $http.pendingRequests.length>0},{isLoading:isLoading}}]),angular.module("xp-gains",[]).config(function($stateProvider){return $stateProvider.state("xp-gains",{url:"/xp-split",templateUrl:"/template/xp-gains/xp-gains.index.ftl",controller:"XpGainsIndexController",data:{title:"XP Gains",subscribe:!0}}).state("xp-gains-graph",{url:"/xp-daily/:skills",templateUrl:"/template/xp-gains/xp-gains.graph.ftl",controller:"XpGainsGraphController",data:{title:"XP Gain - Daily",subscribe:!0}}).state("xp-gains-monthly",{url:"/xp-monthly/:skills",templateUrl:"/template/xp-gains/xp-gains.graph-monthly.ftl",controller:"XpGainsMonthlyController",data:{title:"XP Gain - Monthly",timeline:!1,settings:!1}}).state("xp-gains-monthly-searched-user",{url:"/xp-monthly/player/:username/:skills",templateUrl:"/template/xp-gains/xp-gains.graph-monthly.ftl",controller:"XpGainsSearchedMonthlyController",data:{title:"XP Gain - Monthly",timeline:!1,settings:!1,reqAuth:!1,searched:!0}})}),angular.module("xp-gains").controller("XpGainsIndexController",["$scope","$filter","lodash","xp-gains.manager","timeline.manager","ngTableParams","$state",function($scope,$filter,lodash,xpGainsManager,timelineManager,ngTableParams,$state){var createSkillTable,date,updateSkillTable;return date=timelineManager.getActiveDate(),createSkillTable=function(){return"minute"===timelineManager.getFidelity()&&timelineManager.roundToDay(date),xpGainsManager.getSkillTotals(timelineManager.getActiveDate()).then(function(response){var overallTemp,tempArray;return tempArray=response.data,overallTemp=lodash.find(tempArray,{id:-1}),lodash.remove(tempArray,overallTemp),$scope.overall={icon:overallTemp.icon,id:overallTemp.id,simple:overallTemp.simple,skill:overallTemp.skill,total:overallTemp.total},$scope.tableSkills=tempArray,$scope.tableParams=new ngTableParams({sorting:{total:"desc"}},{counts:[],getData:function($defer,params){return $defer.resolve($filter("orderBy")($scope.tableSkills,params.orderBy()))}})})},updateSkillTable=function(newValue){return createSkillTable()},createSkillTable(),$scope.go=function(id){return $state.go("xp-gains-graph",{skills:id})},$scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue,oldValue){if(newValue!==oldValue)return updateSkillTable(newValue)})}]),angular.module("xp-gains").controller("XpGainsGraphController",["$scope","$stateParams","graphs.composite","timeline.manager","skills.manager","xp-gains.manager","shared.screen-size","settings.manager","lodash","graphs.util","timeline.util","$state",function($scope,$stateParams,graphsBar,timelineManager,skillsManager,xpGainsManager,screenSize,settingsManager,lodash,graphsUtil,timelineUtil,$state){var chart,chartDrawn,date,draw,fetch,graphOptions,skillIds,skillsArray;return date=timelineManager.getActiveDate(),chart=null,chartDrawn=!1,skillIds=$stateParams.skills.split(","),lodash.each(skillIds,function(id,indx){return skillIds[indx]=parseInt(id)}),skillsArray=skillsManager.setActiveSkills(skillIds),graphOptions={},fetch=function(){var dateRange,fidelity;return dateRange={start:moment(date.start),end:moment(date.end)},fidelity=timelineManager.getFidelity(),$scope.noData=!1,xpGainsManager.getGainPeriod(dateRange,skillsArray,fidelity).then(function(response){var append,bars,fullWidthRange,lines;switch(bars=[],lines=[],append="",fidelity){case"hour":append="XP/hr";break;case"minute":append="XP/min";break;default:append="XP/day"}return fullWidthRange={start:moment(dateRange.start),end:moment(dateRange.end)},lodash.forEach(response.data,function(group){var adjustedDate,id,offset;if(id=group.skill,settingsManager.getAverageState()&&lines.push({group:id,style:[2,4],tip:{text:"Average Gain",type:"simple",append:append},points:[{x:fullWidthRange.start,y:group.average},{x:fullWidthRange.end,y:group.average}]}),settingsManager.getPersonalBestState()&&(response.adjacency>0&&(timelineUtil.addAdjacency(response.adjacency,dateRange),offset=(dateRange.end-dateRange.start)/(100/response.adjacency),fullWidthRange={start:moment(dateRange.start-offset),end:moment(dateRange.end+offset)}),lines.push({group:id,style:[12,8],tip:{text:"Personal Best",type:"simple",append:append},points:[{x:fullWidthRange.start,y:group.best},{x:fullWidthRange.end,y:group.best}]})),null!=group.requested&&("day"===fidelity?lodash.each(group.requested,function(bar){return bars.push(graphsUtil.generateBar({group:id,x:bar.day,y:.1*bar.total.xp,tip:{type:"skill",append:"XP",bonus:.1*bar.total.bonus,reward:.1*bar.total.reward}}))}):lodash.each(group.requested,function(val,time){return bars.push(graphsUtil.generateBar({group:id,time:time,x:dateRange.start,y:.1*val.xp,tip:{type:"skill",append:"XP",bonus:.1*val.bonus,reward:.1*val.reward}}))})),null!=group.next&&(adjustedDate=moment(dateRange.start),"minute"===fidelity?adjustedDate.add(1,"hours"):adjustedDate.add(1,"days"),lodash.each(group.next,function(obj,time){return bars.push(graphsUtil.generateBar({group:id,time:time,x:adjustedDate,y:.1*parseInt(obj.xp)}))})),null!=group.previous)return adjustedDate=moment(dateRange.start),"minute"===fidelity?adjustedDate.subtract(1,"hours"):adjustedDate.subtract(1,"days"),lodash.each(group.previous,function(obj,time){return bars.push(graphsUtil.generateBar({group:id,time:time,x:adjustedDate,y:.1*parseInt(obj.xp)}))})}),graphOptions={dateRange:dateRange,fidelity:fidelity,lines:lines,bars:bars,scope:$scope,adjacency:response.adjacency,callback:function(){return chartDrawn=!0}},draw()},function(){return chart&&(chart.remove(),chart=null),$scope.noData=!0})},draw=function(){return chart=graphsBar.create(graphOptions)},fetch(),$scope.$watch(function(){return screenSize.getWidth()},function(){if(chartDrawn)return draw()}),$scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue,oldValue){if(newValue!==oldValue&&chartDrawn)return date=newValue,fetch()}),$scope.$watch(function(){return skillsManager.getActiveSkills()},function(newValue,oldValue){var skillString;if(newValue!==oldValue&&chartDrawn)return skillsArray=newValue,skillString="",0===skillsArray.length?$state.go("xp-gains"):(lodash.each(skillsArray,function(skill,indx){if(skillString+=""+skill.id,indx!==skillsArray.length-1)return skillString+=","}),$state.go($state.current.name,{skills:skillString}))}),$scope.$watch(function(){return settingsManager.getPersonalBestState()},function(){if(chartDrawn)return fetch()}),$scope.$watch(function(){return settingsManager.getAverageState()},function(){if(chartDrawn)return fetch()})}]),angular.module("xp-gains").factory("xp-gains.manager",["$q","$http","lodash","timeline.manager","skills.manager","CONFIG","$filter","shared.calculators",function($q,$http,lodash,timelineManager,skillsManager,CONFIG,$filter,sharedCalculators){var ADJACENCY,clean,currentAdj,fetch,fetchAll,getAverage,getBest,getData,getGainPeriod,getSkillSummaries,getSkillTotals,getTotal;return ADJACENCY=25,currentAdj=ADJACENCY,clean=[],fetchAll=function(selectedDays){var deferred,endTimestamp,startTimestamp,url;return deferred=$q.defer(),startTimestamp="start="+selectedDays.start.valueOf(),url="/aggregations/skill/gain/summary?"+startTimestamp,1!==selectedDays.start.diff(selectedDays.end)&&(endTimestamp="&end="+selectedDays.end.valueOf(),url="/aggregations/skill/gain/summary?"+startTimestamp+endTimestamp),$http.get(url,{timeout:CONFIG.AJAX_TIMOUT}).then(function(response){return 200===response.status?deferred.resolve(response.data):deferred.reject(response.status)},function(response){return deferred.reject(response.status)}),deferred.promise},fetch=function(selectedDays,selectedSkills,fidelity){var adjacencyString,deferred,endTimestamp,skills,startTimestamp,url;switch(deferred=$q.defer(),adjacencyString="&adjacency="+currentAdj,startTimestamp="&start="+selectedDays.start.valueOf(),endTimestamp="&end="+selectedDays.end.valueOf(),url="",skills="",lodash.each(lodash.uniq(selectedSkills,"id"),function(skill){return skills=skills+"&skill="+skill.id}),fidelity){case"minute":startTimestamp="&timestamp="+selectedDays.start.valueOf(),url="/aggregations/skill/gain/hour?"+startTimestamp+skills+adjacencyString;break;case"hour":startTimestamp="&timestamp="+selectedDays.start.valueOf(),url="/aggregations/skill/gain/day?"+startTimestamp+skills+adjacencyString;break;case"day":url="/aggregations/skill/gain/range/day?"+startTimestamp+endTimestamp+skills+adjacencyString}return $http.get(url,{timeout:CONFIG.AJAX_TIMOUT}).then(function(response){return 200===response.status?deferred.resolve(response.data):deferred.reject(response.status)},function(response){return deferred.reject(response.status)}),deferred.promise},getSkillTotals=function(date){var deferred;return deferred=$q.defer(),fetchAll(date).then(function(data){var highest,overallTotal,skillTotals;return skillTotals=[],overallTotal=0,highest=1,lodash.forEach(data,function(d,i){var skillId,skillName,tempObj,total;return skillId=parseInt(i),skillName="Skill "+skillId,skillsManager.getSkill(skillId)&&(skillName=skillsManager.getSkill(skillId).name),total=Math.floor(.1*d),tempObj={id:skillId,icon:skillName.toLowerCase(),skill:skillName,total:total,simple:sharedCalculators.numberSimplifier(total),color:skillsManager.getSkill(skillId).color,percentage:0},skillTotals.push(tempObj),-1!==skillId&&total>highest&&(highest=total),overallTotal+=d}),lodash.forEach(skillTotals,function(d){if(d.percentage=0,0!==d.total)return d.percentage=d.total/highest*100}),deferred.resolve({data:skillTotals})},function(){return deferred.reject()}),deferred.promise},getGainPeriod=function(date,skills,fidelity){var deferred;return deferred=$q.defer(),currentAdj="day"===fidelity?0:ADJACENCY,fetch(date,skills,fidelity).then(function(data){var average,best,day,hour,next,playtime,previous,raw,requested,sum,total;return sum=0,playtime=0,raw=null,null,requested=null,day=null,hour=null,total=null,average=null,best=null,lodash.has(data,"max")?(data.max,lodash.has(data,"gain")&&(raw=data.gain)):raw=data,lodash.isNull(raw)||(clean=[],previous=null,next=null,"day"===fidelity?lodash.forEach(raw,function(skill){var bonusTotal,rewardTotal;return sum=0,lodash.forEach(skill.gain,function(d){return sum+=parseInt(d.total.xp)}),total=Math.floor(.1*sum),best=lodash.isNull(skill.max)?0:Math.floor(.1*skill.max),playtime=lodash.size(skill.gain),average=0===total?0:Math.floor(total/playtime),requested=[],bonusTotal=0,rewardTotal=0,lodash.each(skill.gain,function(obj,i){return requested[i]=obj,bonusTotal+=parseInt(obj.total.bonus),rewardTotal+=parseInt(obj.total.reward)}),clean.push({skill:skill.skill,requested:requested,best:best,total:total,average:average,fidelity:fidelity,bonusTotal:Math.floor(.1*bonusTotal),rewardTotal:Math.floor(.1*rewardTotal)})}):lodash.forEach(raw,function(skill){var bonusTotal,cleanTemp,rewardTotal;return next=lodash.get(skill.gain,"next",null),previous=lodash.get(skill.gain,"previous",null),requested=lodash.get(skill.gain,"requested",null),bonusTotal=0,rewardTotal=0,requested&&(null!=requested.total?(bonusTotal=Math.floor(requested.total.bonus),rewardTotal=Math.floor(requested.total.reward)):lodash.each(requested,function(obj,i){if(null!=obj.bonus)return bonusTotal+=parseInt(obj.bonus),rewardTotal+=parseInt(obj.reward)})),lodash.isNull(requested)?sum=0:("hour"===fidelity?day=requested.day:"minute"===fidelity&&(hour=requested.hour),sum=lodash.isUndefined(requested.total)?0:requested.total.xp,requested=lodash.omit(requested,["total","day","hour"]),playtime=lodash.size(requested),"minute"===fidelity&&requested&&lodash.forEach(requested,function(val){return sum+=parseInt(val.xp)})),total=Math.floor(.1*sum),lodash.isNull(skill.max)||(best=Math.floor(.1*skill.max)),average=0===total?0:Math.floor(total/playtime),"hour"===fidelity?cleanTemp={skill:skill.skill,previous:previous,requested:requested,next:next,best:best,total:total,day:day,average:average,fidelity:fidelity,bonusTotal:Math.floor(.1*bonusTotal),rewardTotal:Math.floor(.1*rewardTotal)}:"minute"===fidelity&&(cleanTemp={skill:skill.skill,previous:previous,requested:requested,next:next,best:best,hour:hour,total:total,average:average,fidelity:fidelity,bonusTotal:Math.floor(.1*bonusTotal),rewardTotal:Math.floor(.1*rewardTotal)}),clean.push(cleanTemp)})),deferred.resolve({data:clean,adjacency:currentAdj})},function(){return deferred.reject()}),deferred.promise},getData=function(){return clean},getAverage=function(d){return $filter("number")(d.average)+" XP/"+d.fidelity},getTotal=function(d){return $filter("number")(d.total)+" XP"},getBest=function(d){return $filter("number")(d.best)+" XP/"+d.fidelity},getSkillSummaries=function(data){var statsArray;return statsArray=[],lodash.forEach(data,function(d){return statsArray.push({id:d.skill,icon:skillsManager.getSkill(d.skill).name.toLowerCase(),skill:skillsManager.getSkill(d.skill).name,color:skillsManager.getSkill(d.skill).color,average:getAverage(d),total:getTotal(d),best:getBest(d),bonus:$filter("number")(d.bonusTotal)+" XP",reward:$filter("number")(d.rewardTotal)+" XP"})}),statsArray},{getGainPeriod:getGainPeriod,getSkillTotals:getSkillTotals,getData:getData,getSkillSummaries:getSkillSummaries}}]),angular.module("xp-gains").directive("xpGainsSummaryTable",["xp-gains.manager","ngTableParams","skills.manager","$filter",function(xpGainsManager,ngTableParams,skillsManager,$filter){var link;return link=function(scope,element,attr){return scope.removeSkill=function(id){return skillsManager.removeFromActiveSkills(id)},scope.$watch(function(){return xpGainsManager.getData()},function(newData){var skills;return skills=xpGainsManager.getSkillSummaries(newData),scope.myValues=skills,scope.tableParams=new ngTableParams({sorting:{skill:"asc"}},{counts:[],getData:function($defer,params){return $defer.resolve($filter("orderBy")(scope.myValues,params.orderBy()))}})})},{link:link,restrict:"E",scope:{},templateUrl:"/template/xp-gains/xp-gains.summary-table.ftl"}}]),angular.module("xp-gains").controller("XpGainsMonthlyController",["$state","$scope","lodash","skills.manager","xp-gains.month-manager","graphs.util","graphs.composite","shared.screen-size","user.player",function($state,$scope,lodash,skillsManager,xpGainsMonthManager,graphsUtil,graphsBar,screenSize,userPlayer){var createGraph,skillIds;return skillIds=[],$state.params.skills&&(skillIds=$state.params.skills.split(","),lodash.each(skillIds,function(id,indx){return skillIds[indx]=parseInt(id)})),0===skillIds.length&&(skillIds=[-1]),skillsManager.setActiveSkills(skillIds),createGraph=function(skills){var bars,dateRange,endDate,graphOptions,startDate;return startDate=moment().subtract(1,"y").startOf("M").add(1,"M"),endDate=moment().startOf("M").add(1,"M"),dateRange={start:moment(startDate),end:moment(endDate)},bars=[],lodash.forEach(skills,function(skill,i){return lodash.each(skill.monthData,function(bar){var time;return time=xpGainsMonthManager.roundTimestamp(bar.timestamp),bars.push(graphsUtil.generateBar({group:skill.skillId,x:moment(time),y:bar.xpGain,zoomable:!1,tip:{type:"skill",append:"XP"}}))})}),graphOptions={dateRange:dateRange,fidelity:"month",bars:bars,scope:$scope},graphsBar.create(graphOptions)},$scope.$watch(function(){return screenSize.getWidth()},function(){return createGraph(xpGainsMonthManager.returnSkills())}),$scope.$watch(function(){return skillsManager.getActiveSkills()},function(response,oldResponse){var skillString;if(response!==oldResponse)return xpGainsMonthManager.getSkills(response),skillString="",lodash.forEach(response,function(skill){return skillString=""!==skillString?skillString+","+skill.id:skill.id}),$state.go($state.current.name,{skills:skillString})}),$scope.$watch(function(){return xpGainsMonthManager.returnSkills()},function(response,oldResponse){if(response!==oldResponse)return createGraph(response)})}]),angular.module("xp-gains").controller("XpGainsSearchedMonthlyController",["$state","$scope","lodash","skills.manager","xp-gains.month-manager","graphs.util","graphs.composite","shared.screen-size","user.player",function($state,$scope,lodash,skillsManager,xpGainsMonthManager,graphsUtil,graphsBar,screenSize,userPlayer){var createGraph,searchedUser,skillIds;return skillIds=[],searchedUser=!1,$state.params.username&&(userPlayer.getSearchedDetails($state.params.username),searchedUser=$state.params.username),$state.params.skills&&(skillIds=$state.params.skills.split(","),lodash.each(skillIds,function(id,indx){return skillIds[indx]=parseInt(id)})),0===skillIds.length&&(skillIds=[-1]),skillsManager.setActiveSkills(skillIds),createGraph=function(skills){var bars,dateRange,endDate,graphOptions,startDate;return startDate=moment().subtract(1,"y").startOf("M").add(1,"M"),endDate=moment().startOf("M").add(1,"M"),dateRange={start:moment(startDate),end:moment(endDate)},bars=[],lodash.forEach(skills,function(skill,i){return lodash.each(skill.monthData,function(bar){var time;return time=xpGainsMonthManager.roundTimestamp(bar.timestamp),bars.push(graphsUtil.generateBar({group:skill.skillId,x:moment(time),y:bar.xpGain,zoomable:!1,tip:{type:"skill",append:"XP"}}))})}),graphOptions={dateRange:dateRange,fidelity:"month",bars:bars,scope:$scope},graphsBar.create(graphOptions)},$scope.$watch(function(){return screenSize.getWidth()},function(){return createGraph(xpGainsMonthManager.returnSearchedSkills())}),$scope.$watch(function(){return skillsManager.getActiveSkills()},function(response,oldResponse){var skillString;if(response!==oldResponse)return xpGainsMonthManager.getSearchedSkills(searchedUser,response),skillString="",lodash.forEach(response,function(skill){return skillString=""!==skillString?skillString+","+skill.id:skill.id}),$state.go($state.current.name,{skills:skillString})}),$scope.$watch(function(){return xpGainsMonthManager.returnSearchedSkills()},function(response,oldResponse){if(response!==oldResponse)return createGraph(response)})}]),angular.module("xp-gains").factory("xp-gains.month-manager",["$q","$http","lodash",function($q,$http,lodash){var allSearchedXpGains,allXpGains,getSearchedSkills,getSkills,returnSearchedSkills,returnSkills,roundTimestamp,searchedUser,searchedXpGains,xpGains;return allXpGains=[],xpGains=[],allSearchedXpGains=[],searchedXpGains=[],searchedUser="",getSkills=function(skills){var tempData;return tempData=[],lodash.forEach(skills,function(skill,i){var deferred,tempObj;return deferred=$q.defer(),tempObj=lodash.find(allXpGains,function(o){return o.skillId===skill.id}),tempObj?(tempData.push(tempObj),skills.length===tempData.length?xpGains=tempData:void 0):($http.get("/xp-monthly?skillid="+skill.id).then(function(response){return response.data.monthlyXpGain?deferred.resolve(response.data.monthlyXpGain[0]):deferred.reject(response.status)},function(response){return deferred.reject(response.status)}),deferred.promise.then(function(data){if(allXpGains.push(data),tempData.push(data),skills.length===tempData.length)return xpGains=tempData}))})},getSearchedSkills=function(user,skills){var tempData;return tempData=[],user!==searchedUser&&(allSearchedXpGains=[],searchedUser=user),lodash.forEach(skills,function(skill,i){var deferred,tempObj;return deferred=$q.defer(),tempObj=lodash.find(allSearchedXpGains,function(o){return o.skillId===skill.id}),tempObj?(tempData.push(tempObj),skills.length===tempData.length?searchedXpGains=tempData:void 0):($http.get("/xp-monthly?searchName="+user+"&skillid="+skill.id).then(function(response){return response.data.monthlyXpGain?deferred.resolve(response.data.monthlyXpGain[0]):deferred.reject(response.status)},function(response){return deferred.reject(response.status)}),deferred.promise.then(function(data){if(allSearchedXpGains.push(data),tempData.push(data),skills.length===tempData.length)return searchedXpGains=tempData}))})},returnSkills=function(){return xpGains},returnSearchedSkills=function(){return searchedXpGains},roundTimestamp=function(time){return moment(time).startOf("month")},{getSkills:getSkills,getSearchedSkills:getSearchedSkills,returnSkills:returnSkills,returnSearchedSkills:returnSearchedSkills,roundTimestamp:roundTimestamp}}]),angular.module("xp-gains").directive("xpGainsMonthlyTable",["lodash","ngTableParams","skills.manager","$filter","xp-gains.manager","xp-gains.month-manager",function(lodash,ngTableParams,skillsManager,$filter,xpGainsManager,xpGainsMonthManager){var link;return link=function(scope,element,attr){var createTable;return createTable=function(skills){var tempData;return tempData=[],lodash.forEach(skills,function(value){var latestMonth,skillInfo;return skillInfo=skillsManager.getSkill(value.skillId),latestMonth=value.monthData[value.monthData.length-1],value.name=skillInfo.name,value.color=skillInfo.color,value.icon=value.name.toLowerCase(),0===value.monthData.length?(value.monthGain=0,value.rank=0):(value.monthGain=latestMonth.xpGain,value.rank=latestMonth.rank),tempData.push(value)}),scope.myValues=tempData,scope.tableParams=new ngTableParams({sorting:{skillId:"asc"}},{counts:[],getData:function($defer,params){return $defer.resolve($filter("orderBy")(scope.myValues,params.orderBy()))}})},scope.removeSkill=function(id){return skillsManager.removeFromActiveSkills(id)},scope.$watch(function(){return xpGainsMonthManager.returnSkills()},function(skills){return createTable(skills)}),scope.$watch(function(){return xpGainsMonthManager.returnSearchedSkills()},function(skills){return createTable(skills)})},{link:link,restrict:"E",scope:{},templateUrl:"/template/xp-gains/xp-gains.monthly-table.ftl"}}]),angular.module("pvm-kills",["ngTable"]).config(function($stateProvider){return $stateProvider.state("pvm-kills",{url:"/pvm-kills",templateUrl:"/template/pvm-kills/pvm-kills.index.ftl",controller:"PvmKillsIndexController",data:{title:"PvM Kills",subscribe:!0}})}),angular.module("pvm-kills").controller("PvmKillsIndexController",["$scope","graphs.composite","shared.calculators","timeline.manager","pvm-kills.manager","shared.screen-size","lodash","graphs.util","settings.manager",function($scope,graphsBar,sharedCalculators,timelineManager,pvmKillsManager,screenSize,lodash,graphsUtil,settingsManager){var chart,chartDrawn,date,draw,fetch,graphOptions;return date=timelineManager.getActiveDate(),chart=null,chartDrawn=!1,graphOptions={},$scope.monsterId=0,fetch=function(){var dateRange,fidelity;return dateRange={start:moment(date.start),end:moment(date.end)},"minute"===timelineManager.getFidelity()&&(dateRange={start:dateRange.start.startOf("day"),end:dateRange.end.endOf("day")},timelineManager.setActiveDate(dateRange)),fidelity=timelineManager.getFidelity(),$scope.noData=!1,pvmKillsManager.getPVMPeriod(dateRange,fidelity).then(function(kills){var bars,zoomable;return bars=[],$scope.date=timelineManager.getHumanDate(date),null!=kills&&(zoomable=!0,"hour"===fidelity&&(zoomable=!1),"day"===fidelity?lodash.each(kills,function(bar){return bars.push(graphsUtil.generateBar({zoomable:zoomable,tip:{type:"icon",icon:"images/kills_total.f16b25f5.png",append:"Kills"},x:bar.day,y:bar.total}))}):lodash.each(kills,function(bar){return bars.push(graphsUtil.generateBar({zoomable:zoomable,tip:{type:"icon",icon:"images/kills_total.f16b25f5.png",append:"Kills"},time:bar.hour,x:dateRange.start,y:bar.total}))})),graphOptions={dateRange:dateRange,fidelity:fidelity,bars:bars,scope:$scope,callback:function(){return chartDrawn=!0}},draw()},function(){return chart&&(chart.remove(),chart=null),$scope.noData=!0})},draw=function(){return chart=graphsBar.create(graphOptions)},fetch(),$scope.$watch(function(){return screenSize.getWidth()},function(){if(chartDrawn)return draw()}),$scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue,oldValue){if(newValue!==oldValue)return date=newValue,fetch()}),$scope.$watch(function(){return settingsManager.getAverageState()},function(){if(chartDrawn)return fetch()})}]),angular.module("pvm-kills").factory("pvm-kills.manager",["$q","$http","lodash","timeline.util","CONFIG",function($q,$http,lodash,timelineUtil,CONFIG){var ADJACENCY,clean,currentAdj,fetch,getData,getPVMPeriod;return ADJACENCY=0,currentAdj=ADJACENCY,clean={},fetch=function(selectedDays){var deferred,endTimestamp,startTimestamp,url;return deferred=$q.defer(),startTimestamp="&start="+selectedDays.start.valueOf(),endTimestamp="&end="+selectedDays.end.valueOf(),url="/aggregations/npc/kill/range/day?"+startTimestamp+endTimestamp,$http.get(url,{timeout:CONFIG.AJAX_TIMOUT}).then(function(response){return 200===response.status?deferred.resolve(response.data):deferred.reject(response.status)},function(response){return deferred.reject(response.status)}),deferred.promise},getPVMPeriod=function(date,fidelity){var amendedDate,deferred;return deferred=$q.defer(),currentAdj="day"===fidelity?0:ADJACENCY,currentAdj>0&&(amendedDate=timelineUtil.addAdjacency(currentAdj,date),date.start=moment(amendedDate.start),date.end=moment(amendedDate.end)),fetch(date).then(function(data){var worker,workerThread;return worker=new Worker(CONFIG.CONTEXT+"/js/app/pvm-kills/workers/pvm-aggregator.js"),workerThread=$q.defer(),worker.postMessage({json:data,fidelity:fidelity,ctx:CONFIG.CONTEXT}),worker.addEventListener("message",function(e){return worker.terminate,workerThread.resolve(e)},!1),workerThread.promise.then(function(e){return clean=e.data,deferred.resolve(clean.kills)})},function(){return deferred.reject()}),deferred.promise},getData=function(){return clean},{getPVMPeriod:getPVMPeriod,getData:getData}}]),angular.module("pvm-kills").directive("pvmKillsTable",["pvm-kills.manager","ngTableParams","$filter","lodash","drop-log.manager","timeline.manager",function(pvmKillsManager,ngTableParams,$filter,lodash,dropLogManager,timelineManager){var link;return link=function(scope,element,attr){var monsterId;return monsterId=0,scope.$watchCollection(function(){return pvmKillsManager.getData()},function(newData){var total;if(null!=newData.kills)return scope.myValues=newData.monsters,total=0,lodash.each(newData.kills,function(segment){return total+=segment.total}),scope.kills=$filter("number")(total),scope.tableParams=new ngTableParams({count:15,sorting:{kills:"desc"}},{counts:[],paginationMaxBlocks:4,paginationMinBlocks:2,dataset:scope.myValues,getData:function($defer,params){return scope.myValues=$filter("orderBy")(scope.myValues,params.orderBy()),$defer.resolve(scope.myValues.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),scope.fetchDrops=function(id,name,level,kills){var date,dateRange,fidelity;return date=timelineManager.getActiveDate(),monsterId=id,dateRange={start:moment(date.start),end:moment(date.end)},fidelity=timelineManager.getFidelity(),dropLogManager.getDropPeriod({date:dateRange,fidelity:fidelity},monsterId,name,level,kills)}},{link:link,restrict:"E",scope:{},templateUrl:"/template/pvm-kills/pvm-kills.table.ftl"}}]),angular.module("drop-log",["ngTable"]).config(function($stateProvider){$stateProvider.state("drop-log",{url:"/drop-log",templateUrl:"/template/drop-log/drop-log.index.ftl",controller:"DropLogIndexController",data:{title:"Drop Log",subscribe:!0}})}),angular.module("drop-log").controller("DropLogIndexController",["$scope","$filter","lodash","timeline.manager","drop-log.manager","ngTableParams","$state",function($scope,$filter,lodash,timelineManager,dropLogManager,ngTableParams,$state){}]),angular.module("drop-log").factory("drop-log.manager",["$q","$http","lodash","timeline.util","shared.calculators","CONFIG",function($q,$http,lodash,timelineUtil,sharedCalculators,CONFIG){var ADJACENCY,clean,currentAdj,fetch,getData,getDropPeriod;return ADJACENCY=0,currentAdj=ADJACENCY,clean={},fetch=function(selectedDays,monsterId){var deferred,endTimestamp,startTimestamp,url;return monsterId="&id="+monsterId,deferred=$q.defer(),startTimestamp="&start="+selectedDays.start.valueOf(),endTimestamp="&end="+selectedDays.end.valueOf(),url="/aggregations/npc/drop-log/range/day?"+startTimestamp+endTimestamp+monsterId,$http.get(url,{timeout:CONFIG.AJAX_TIMOUT}).then(function(response){return 200===response.status?deferred.resolve(response.data):deferred.reject(response.status)},function(response){return deferred.reject(response.status)}),deferred.promise},getDropPeriod=function(opt,monsterId,name,level,kills){var amendedDate,_opt;return _opt=lodash.assign({filter:!1},opt),currentAdj="day"===_opt.fidelity?0:ADJACENCY,currentAdj>0&&(amendedDate=timelineUtil.addAdjacency(currentAdj,_opt.date),_opt.date.start=moment(amendedDate.start),_opt.date.end=moment(amendedDate.end)),fetch(_opt.date,monsterId,name,level,kills).then(function(data){return 0===monsterId?data.name="All Drops":(data.name=name,data.level=level,data.kills=kills),clean=data})},getData=function(){return clean},{getDropPeriod:getDropPeriod,getData:getData}}]),angular.module("drop-log").directive("dropLogTable",["drop-log.manager","timeline.manager","ngTableParams","shared.calculators","$filter","lodash","pvm-kills.manager",function(dropLogManager,timelineManager,ngTableParams,sharedCalculators,$filter,lodash,pvmKillsManager){var link;return link=function(scope,element,attr){var date,fetch,monsterId;return date=timelineManager.getActiveDate(),monsterId=0,fetch=function(){var dateRange,fidelity;return dateRange={start:moment(date.start),end:moment(date.end)},fidelity=timelineManager.getFidelity(),dropLogManager.getDropPeriod({date:dateRange,fidelity:fidelity},monsterId)},fetch(),scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue,oldValue){if(newValue!==oldValue)return date=newValue,fetch()}),scope.$watch(function(){return dropLogManager.getData()},function(newData){var quantity,sumQuantity,sumTotal,tempData,totalValue;return scope.monster={name:newData.name,level:newData.level,kills:newData.kills},delete newData.name,delete newData.level,delete newData.kills,sumQuantity=lodash.map(newData,"quantity"),quantity=lodash.sum(sumQuantity),sumTotal=lodash.map(newData,"totalValue"),totalValue=lodash.sum(sumTotal),scope.total={quantity:quantity,totalValue:totalValue},
tempData=[],lodash.forEach(newData,function(value,key){return tempData.push(value)}),scope.values=tempData,scope.tableParams=new ngTableParams({count:15,sorting:{totalValue:"desc"}},{counts:[],paginationMaxBlocks:4,paginationMinBlocks:2,dataset:scope.values}),{getData:function($defer,params){return scope.values=$filter("orderBy")(scope.values,params.orderBy()),$defer.resolve(scope.values.slice((params.page()-1)*params.count(),params.page()*params.count()))}}})},{link:link,restrict:"E",scope:{},templateUrl:"/template/drop-log/drop-log.table.ftl"}}]),angular.module("wealth-change",[]).config(function($stateProvider){return $stateProvider.state("wealth-change",{url:"/wealth",templateUrl:"/template/wealth-change/wealth-change.index.ftl",controller:"WealthChangeIndexController",data:{title:"Wealth Change",subscribe:!0}})}),angular.module("wealth-change").controller("WealthChangeIndexController",["$scope","graphs.composite","$filter","timeline.manager","wealth-change.manager","shared.screen-size","lodash","graphs.util","settings.manager",function($scope,graphsBar,$filter,timelineManager,wealthChangeManager,screenSize,lodash,graphsUtil,settingsManager){var chart,chartDrawn,date,draw,fetch,graphOptions;return date=timelineManager.getActiveDate(),chart=null,chartDrawn=!1,graphOptions={},fetch=function(){var dateRange,fidelity;return dateRange={start:moment(date.start),end:moment(date.end)},fidelity=timelineManager.getFidelity(),wealthChangeManager.getChangePeriod(dateRange,fidelity).then(function(response){var adjustedDate,bars,data,lines;return bars=[],lines=[],data=response.data,null!=data.average&&($scope.average=$filter("number")(data.average)+" GP/"+fidelity),$scope.date=timelineManager.getHumanDate(date),null!=data.total&&($scope.net=$filter("number")(data.total)+" GP"),settingsManager.getAverageState()&&lines.push({group:-1,style:[2,4],tip:{type:"simple",text:"Average Change",append:" GP"},points:[{x:dateRange.start,y:data.average},{x:dateRange.end,y:data.average}]}),null!=data&&("day"===fidelity?lodash.each(data.requested.change,function(bar){return bars.push(graphsUtil.generateBar({group:-1,tip:{type:"icon",text:"Wealth Change",append:" GP",icon:"images/coin.f68ee68d.png"},x:bar.day,y:bar.total}))}):lodash.each(data.requested,function(total,time){return bars.push(graphsUtil.generateBar({group:-1,tip:{type:"icon",text:"Wealth Change",append:" GP",icon:"images/coin.f68ee68d.png"},time:time,x:dateRange.start,y:total}))})),null!=data.next&&(adjustedDate=moment(dateRange.start),"minute"===fidelity?adjustedDate.add(1,"hours"):adjustedDate.add(1,"days"),lodash.each(data.next,function(total,time){return bars.push(graphsUtil.generateBar({tip:{type:"icon",text:"Wealth Change",append:" GP",icon:"images/coin.f68ee68d.png"},time:time,x:adjustedDate,y:total}))})),null!=data.previous&&(adjustedDate=moment(dateRange.start),"minute"===fidelity?adjustedDate.subtract(1,"hours"):adjustedDate.subtract(1,"days"),lodash.each(data.previous,function(total,time){return bars.push(graphsUtil.generateBar({tip:{type:"icon",text:"Wealth Change",append:" GP",icon:"images/coin.f68ee68d.png"},time:time,x:adjustedDate,y:total}))})),graphOptions={dateRange:dateRange,fidelity:fidelity,lines:lines,bars:bars,mirrorYAxis:!0,scope:$scope,adjacency:response.adjacency,callback:function(){return chartDrawn=!0}},draw()},function(){if(chart)return chart.remove(),chart=null})},draw=function(){return chart=graphsBar.create(graphOptions)},fetch(),$scope.$watch(function(){return screenSize.getWidth()},function(){if(chartDrawn)return draw()}),$scope.$watchCollection(function(){return timelineManager.getActiveDate()},function(newValue,oldValue){if(newValue!==oldValue)return date=newValue,fetch()}),$scope.$watch(function(){return settingsManager.getAverageState()},function(){if(chartDrawn)return fetch()})}]),angular.module("wealth-change").factory("wealth-change.manager",["$q","$http","lodash","timeline.manager","CONFIG",function($q,$http,lodash,timelineManager,CONFIG){var ADJACENCY,currentAdj,fetch,getChangePeriod;return ADJACENCY=25,currentAdj=ADJACENCY,fetch=function(selectedDays,fidelity){var adjacencyString,deferred,endTimestamp,startTimestamp,url;switch(deferred=$q.defer(),adjacencyString="&adjacency="+currentAdj,startTimestamp="&start="+selectedDays.start.valueOf(),endTimestamp="&end="+selectedDays.end.valueOf(),url="",fidelity){case"minute":startTimestamp="&timestamp="+selectedDays.start.valueOf(),url="/aggregations/wealth/change/hour?"+startTimestamp+adjacencyString;break;case"hour":startTimestamp="&timestamp="+selectedDays.start.valueOf(),url="/aggregations/wealth/change/day?"+startTimestamp+adjacencyString;break;case"day":url="/aggregations/wealth/change/range/day?"+startTimestamp+endTimestamp+adjacencyString}return $http.get(url,{timeout:CONFIG.AJAX_TIMOUT}).then(function(response){return 200===response.status?deferred.resolve(response.data):deferred.reject(response.status)},function(response){return deferred.reject(response.status)}),deferred.promise},getChangePeriod=function(date,fidelity){var deferred;return deferred=$q.defer(),currentAdj="day"===fidelity?0:ADJACENCY,fetch(date,fidelity).then(function(data){var average,clean,day,hour,next,playtime,previous,requested,sum;return lodash.isNull(data)||(clean={},average=null,playtime=null,sum=null,"day"===fidelity?(sum=0,lodash.forEach(data,function(d){return sum=0,lodash.forEach(d,function(c){return sum+=parseInt(c.total)}),playtime=lodash.size(d)}),average=0===sum?0:Math.floor(sum/playtime),clean={requested:data,average:average,total:sum}):(next=lodash.get(data.change,"next",null),previous=lodash.get(data.change,"previous",null),requested=lodash.get(data.change,"requested",null),hour=null,day=null,lodash.isNull(requested)?sum=0:("hour"===fidelity?day=requested.day:"minute"===fidelity&&(hour=requested.hour),sum=lodash.isUndefined(requested.total)?0:requested.total,requested=lodash.omit(requested,["total","day","hour"]),playtime=lodash.size(requested),"minute"===fidelity&&lodash.forEach(requested,function(val){return sum+=parseInt(val)})),average=0===sum?0:Math.floor(sum/playtime),clean={previous:previous,requested:requested,average:average,next:next,total:sum},"hour"===fidelity?clean.day=day:"minute"===fidelity&&(clean.hour=hour))),deferred.resolve({data:clean,adjacency:currentAdj})},function(){return deferred.reject()}),deferred.promise},{getChangePeriod:getChangePeriod}}]),angular.module("activities",[]).config(function($stateProvider){return $stateProvider.state("activities",{url:"/activities",templateUrl:"/template/activities/activities.index.ftl",controller:"ActivitiesIndex",data:{title:"Activities",timeline:!1,settings:!1}}).state("activities-searched-user",{url:"/activities/player/:username",templateUrl:"/template/activities/activities.index.ftl",controller:"ActivitiesSearchedUser",data:{title:"Activities",timeline:!1,settings:!1,reqAuth:!1,searched:!0}})}),angular.module("activities").controller("ActivitiesIndex",["$scope","user.player",function($scope,userPlayer){return userPlayer.getDetails().then(function(response){return $scope.player=response})}]),angular.module("activities").controller("ActivitiesSearchedUser",["$state","$scope","user.player",function($state,$scope,userPlayer){return $scope.player=!1,userPlayer.getSearchedDetails($state.params.username).then(function(response){return $scope.player=response})}]),angular.module("search",[]).config(function($stateProvider){return $stateProvider.state("search",{url:"/search",templateUrl:"/template/search/search.index.ftl",data:{title:"Player Search",timeline:!1,settings:!1,reqAuth:!1}}).state("search-error",{url:"/search-error/:error",templateUrl:"/template/search/search.index.ftl",controller:"SearchError",data:{title:"Player Search",timeline:!1,settings:!1,reqAuth:!1}})}),angular.module("search").controller("SearchError",["$scope","$stateParams",function($scope,$stateParams){switch($stateParams.error){case"PROFILE_PRIVATE":return $scope.error="Sorry, that player's profile is private.";default:return $scope.error="Sorry, that player could not be found."}}]),angular.module("search").directive("searchForm",["$state",function($state){var link;return link=function(scope,element,attr){return scope.findPlayer=function(player){return $state.go("overview-searched-user",{username:player})}},{link:link,restrict:"E",scope:{},templateUrl:"/template/search/search.form.ftl"}}]),angular.module("search").directive("searchFormSmall",["$state",function($state){var link;return link=function(scope,element,attr){return scope.findPlayer=function(player){return $state.go("overview-searched-user",{username:player})}},{link:link,restrict:"E",scope:{},templateUrl:"/template/search/search.form-small.ftl"}}]),angular.module("friends",[]).config(function($stateProvider){return $stateProvider.state("friends",{url:"/friends",templateUrl:"/template/friends/friends.index.ftl",data:{title:"Friends list",timeline:!1,settings:!1}})}),angular.module("friends").factory("friends.manager",["$q","$http",function($q,$http){var getFriendsList;return getFriendsList=function(){var deferred;return deferred=$q.defer(),$http.get("/friendslist").then(function(response){return deferred.resolve(response.data)},function(response){return deferred.reject(response.status)}),deferred.promise},{getFriendsList:getFriendsList}}]),angular.module("friends").directive("friendsTable",["lodash","ngTableParams","$filter","friends.manager",function(lodash,ngTableParams,$filter,friendsManager){var link;return link=function(scope,element,attr){var createTable;return scope.friendsOnline=0,scope.friendsTotal=0,scope.dataPresent=!1,createTable=function(friends){var tempData;return scope.dataPresent=!0,tempData=[],lodash.forEach(friends,function(value,key){return value.avatar="https://secure.runescape.com/m=avatar-rs/"+value.displayName.replace(/\s+/g,"+")+"/chat.png",value.online="Offline",value.currentGameWorld.length>0&&(value.online="Online",scope.friendsOnline=scope.friendsOnline+1),tempData.push(value)}),scope.values=tempData,scope.friendsTotal=scope.values.length,scope.tableParams=new ngTableParams({count:30,sorting:{currentGameWorld:"desc"}},{counts:[],paginationMaxBlocks:4,paginationMinBlocks:2,dataset:scope.values,getData:function($defer,params){return scope.values=$filter("orderBy")(scope.values,params.orderBy()),$defer.resolve(scope.values.slice((params.page()-1)*params.count(),params.page()*params.count()))}})},friendsManager.getFriendsList().then(function(response){return createTable(response.friends)})},{link:link,restrict:"E",scope:{},templateUrl:"/template/friends/friends.table.ftl"}}]),angular.module("friends-activity",[]).config(function($stateProvider){return $stateProvider.state("friends-activity",{url:"/friends-activity",templateUrl:"/template/friends-activity/friends-activity.index.ftl",controller:"FriendsActivityIndex",data:{title:"Friends Activity",timeline:!1,settings:!1}})}),angular.module("friends-activity").factory("friends-activity.manager",["$q","$http",function($q,$http){var getFriendsActivity;return getFriendsActivity=function(){var deferred;return deferred=$q.defer(),$http.get("/friendsactivity").then(function(response){return deferred.resolve(response.data)},function(response){return deferred.reject(response.status)}),deferred.promise},{getFriendsActivity:getFriendsActivity}}]),angular.module("friends-activity").controller("FriendsActivityIndex",["friends-activity.manager","$scope","lodash","$state",function(friendsActivityManager,$scope,lodash,$state){return $scope.findPlayer=function(player){return $state.go("overview-searched-user",{username:player})},friendsActivityManager.getFriendsActivity().then(function(response){return $scope.player=response,lodash.forEach($scope.player,function(value,key){return lodash.forEach(value,function(value,key){return value.avatar="https://secure.runescape.com/m=avatar-rs/"+value.displayName.replace(/\s+/g,"+")+"/chat.png",value.friendsActivityTime=moment(parseInt(value.activityTimestamp)).format("DD-MMM-YYYY hh:mm")})})})}]),angular.module("quests",[]).config(function($stateProvider){return $stateProvider.state("quests",{url:"/quests",templateUrl:"/template/quests/quests.index.ftl",data:{title:"Quests",timeline:!1,settings:!1,reqAuth:!1}}).state("quests-searched-user",{url:"/quests/player/:username",templateUrl:"/template/quests/quests.index.ftl",data:{title:"Quests",timeline:!1,settings:!1,reqAuth:!1,searched:!0}})}),angular.module("quests").factory("quests.manager",["$q","$http",function($q,$http){var getDifficultyText,getQuests,getSearchedQuests,getStatusColor;return getDifficultyText=function(int){switch(int){case 250:return"Special";case 4:return"Grandmaster";case 3:return"Master";case 2:return"Experienced";case 1:return"Intermediate";default:return"Novice"}},getStatusColor=function(status){var completeColor,inProgColor,notEligableColor,notStartedColor;switch(completeColor="#01B050",inProgColor="#FCC002",notStartedColor="#FE0101",notEligableColor="#BEBFC2",status){case"COMPLETED":return completeColor;case"STARTED":return inProgColor;case"NOT_ELIGIBLE":return notEligableColor;default:return notStartedColor}},getQuests=function(){var deferred;return deferred=$q.defer(),$http.get("/quests").then(function(response){return deferred.resolve(response.data)},function(response){return deferred.reject(response.status)}),deferred.promise},getSearchedQuests=function(user){var deferred;return deferred=$q.defer(),$http.get("/quests?user="+user).then(function(response){return deferred.resolve(response.data)},function(response){return deferred.reject(response.status)}),deferred.promise},{getDifficultyText:getDifficultyText,getStatusColor:getStatusColor,getQuests:getQuests,getSearchedQuests:getSearchedQuests}}]),angular.module("quests").directive("questsTable",["$state","lodash","$filter","ngTableParams","quests.manager","user.player",function($state,lodash,$filter,ngTableParams,questsManager,userPlayer){var link;return link=function(scope,element,attr){var createTable;return scope.dataPresent=!0,createTable=function(quests){var tempData;return tempData=[],lodash.forEach(quests,function(value,key){return value.userEligible||"COMPLETED"===value.status||(value.status="NOT_ELIGIBLE"),value.statusColor=questsManager.getStatusColor(value.status),value.status=value.status.toLowerCase(),value.status=value.status.charAt(0).toUpperCase()+value.status.slice(1),value.status=value.status.replace(/_/g," "),value.difficultyText=questsManager.getDifficultyText(value.difficulty),tempData.push(value)}),scope.values=tempData,scope.tableParams=new ngTableParams({sorting:{status:"asc"}},{counts:[],getData:function($defer,params){return scope.values=$filter("orderBy")(scope.values,params.orderBy())}})},$state.params.username?(userPlayer.getSearchedDetails($state.params.username),questsManager.getSearchedQuests($state.params.username).then(function(response){return response.quests?(scope.dataPresent=!0,createTable(response.quests)):scope.dataPresent=!1})):questsManager.getQuests().then(function(response){return response.quests?(scope.dataPresent=!0,createTable(response.quests)):scope.dataPresent=!1})},{link:link,restrict:"E",scope:{},templateUrl:"/template/quests/quests.table.ftl"}}]),angular.module("welcome",[]).config(function($stateProvider){return $stateProvider.state("welcome",{url:"/welcome",templateUrl:"/template/welcome/welcome.index.ftl",data:{title:"Welcome",timeline:!1,settings:!1,reqAuth:!1}}).state("welcome-ad-log",{url:"/welcome/ad-log",templateUrl:"/template/welcome/welcome.index.ftl",data:{title:"Welcome",timeline:!1,settings:!1,reqAuth:!1}})}),angular.module("upsell",[]).config(function($stateProvider){return $stateProvider.state("subscribe",{url:"/subscribe",templateUrl:"/template/upsell/upsell.index.ftl",data:{title:"RuneMetrics Pro",subscribe:!1,settings:!1,timeline:!1}}).state("subscribe-kills-drops",{url:"/subscribe/kills-drops",templateUrl:"/template/upsell/upsell.kills-drops.ftl",data:{title:"RuneMetrics Pro",subscribe:!1,settings:!1,timeline:!1}}).state("subscribe-xp-gains",{url:"/subscribe/xp-gains",templateUrl:"/template/upsell/upsell.xp-gains.ftl",data:{title:"RuneMetrics Pro",subscribe:!1,settings:!1,timeline:!1}})});